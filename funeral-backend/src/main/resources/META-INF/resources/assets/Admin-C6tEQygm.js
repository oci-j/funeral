import{r as d,ag as I,m as oe,C as n,z as ne,c as L,o as p,d as l,w as a,n as ue,v as ie,g as U,x as de,F as me,H as pe,L as ce,s as u,t as D,a8 as fe,l as ye,j as _e,u as v,ax as ge,ay as ve,M as j,p as we,a as R,az as q,i as be,ae as Ue,b as B,af as Pe,J as Ve,aj as Ee,ak as ke,al as Ce,U as xe,aw as Ae,B as c,A as O}from"./index-Y3_aSSC5.js";/* empty css                   *//* empty css                    *//* empty css                     *//* empty css                  */import{_ as he}from"./el-input-BtvPs5Ei.js";/* empty css                  *//* empty css                        */import{a as De}from"./useAuthCheck-CpN-XPmU.js";const Re={class:"admin-container"},Be={class:"card-header"},ze={class:"permission-controls"},Se={__name:"Admin",setup(Fe){const G=ne(),z=d([]),E=d(!1),k=d(!1),f=d(!1),C=d(!1),y=d(null),_=d(null),S=d([]),x=d(),r=I({username:"",email:"",password:"",roles:["USER"],enabled:!0}),o=I({repository:"",canPull:!0,canPush:!1}),H={username:[{required:!0,message:"Please input username",trigger:"blur"},{min:3,message:"Username must be at least 3 characters",trigger:"blur"}],email:[{type:"email",message:"Please input correct email address",trigger:"blur"}],password:[{required:!0,message:"Please input password",trigger:"blur"},{min:6,message:"Password must be at least 6 characters",trigger:"blur"}]},A=async()=>{E.value=!0;try{z.value=await c.getUsers()}catch(t){n.error("Failed to fetch users: "+t.message)}finally{E.value=!1}},J=t=>{y.value=t,Object.assign(r,{username:t.username,email:t.email||"",password:"",roles:t.roles||["USER"],enabled:t.enabled!==!1}),f.value=!0},K=async()=>{if(!(!x.value||!await x.value.validate())){k.value=!0;try{const e={username:r.username,email:r.email,password:r.password,roles:r.roles,enabled:r.enabled};y.value?(delete e.password,await c.updateUser(y.value.username,e),n.success("User updated successfully")):(await c.createUser(e),n.success("User created successfully")),f.value=!1,A()}catch(e){n.error(e.message)}finally{k.value=!1}}},Q=async t=>{try{await O.confirm(`Are you sure you want to delete user "${t.username}"?`,"Delete User",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}),await c.deleteUser(t.username),n.success("User deleted successfully"),A()}catch(e){e!=="cancel"&&n.error(e.message)}},W=async t=>{_.value=t,C.value=!0,await h(t.username)},h=async t=>{try{S.value=await c.getUserPermissions(t)}catch(e){n.error("Failed to fetch permissions: "+e.message)}},X=async()=>{if(!o.repository){n.warning("Please enter repository name");return}try{await c.setUserPermission(_.value.username,o.repository,{canPull:o.canPull,canPush:o.canPush}),n.success("Permission added successfully"),o.repository="",o.canPull=!0,o.canPush=!1,await h(_.value.username)}catch(t){n.error(t.message)}},Y=async t=>{try{await O.confirm(`Are you sure you want to remove permission for repository "${t.repositoryName}"?`,"Delete Permission",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}),await c.deleteUserPermission(_.value.username,t.repositoryName),n.success("Permission deleted successfully"),await h(_.value.username)}catch(e){e!=="cancel"&&n.error(e.message)}},Z=t=>t?new Date(t).toLocaleString():"";return oe(async()=>{const{checkAdmin:t}=De();if(!await t()){n.error("Access denied: Admin privileges required"),G.push("/");return}A()}),(t,e)=>{var M;const w=_e,m=ye,i=de,P=ce,ee=fe,F=we,le=be,V=Ve,b=Pe,N=ke,ae=Ee,se=Ce,te=Ue,$=xe,T=Ae,re=ie;return p(),L("div",Re,[l(le,{class:"admin-card"},{header:a(()=>[R("div",Be,[e[13]||(e[13]=R("h2",null,"User Management",-1)),l(m,{type:"primary",onClick:e[0]||(e[0]=s=>f.value=!0)},{default:a(()=>[l(w,null,{default:a(()=>[l(v(q))]),_:1}),e[12]||(e[12]=u(" Create User ",-1))]),_:1})])]),default:a(()=>[ue((p(),U(F,{data:z.value,style:{width:"100%"}},{default:a(()=>[l(i,{prop:"username",label:"Username",width:"150"}),l(i,{prop:"email",label:"Email",width:"200"}),l(i,{label:"Roles",width:"150"},{default:a(({row:s})=>[(p(!0),L(me,null,pe(s.roles,g=>(p(),U(P,{key:g,size:"small",style:{"margin-right":"5px"}},{default:a(()=>[u(D(g),1)]),_:2},1024))),128))]),_:1}),l(i,{label:"Status",width:"100"},{default:a(({row:s})=>[l(P,{type:s.enabled?"success":"danger",size:"small"},{default:a(()=>[u(D(s.enabled?"Enabled":"Disabled"),1)]),_:2},1032,["type"])]),_:1}),l(i,{prop:"createdAt",label:"Created",width:"180"},{default:a(({row:s})=>[u(D(Z(s.createdAt)),1)]),_:1}),l(i,{label:"Actions",width:"250",fixed:"right"},{default:a(({row:s})=>[l(ee,null,{default:a(()=>[l(m,{size:"small",onClick:g=>J(s)},{default:a(()=>[l(w,null,{default:a(()=>[l(v(ge))]),_:1})]),_:1},8,["onClick"]),l(m,{size:"small",onClick:g=>W(s)},{default:a(()=>[l(w,null,{default:a(()=>[l(v(ve))]),_:1})]),_:1},8,["onClick"]),l(m,{size:"small",type:"danger",onClick:g=>Q(s),disabled:s.username==="admin"},{default:a(()=>[l(w,null,{default:a(()=>[l(v(j))]),_:1})]),_:1},8,["onClick","disabled"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[re,E.value]])]),_:1}),l($,{modelValue:f.value,"onUpdate:modelValue":e[7]||(e[7]=s=>f.value=s),title:y.value?"Edit User":"Create User",width:"500px"},{footer:a(()=>[l(m,{onClick:e[6]||(e[6]=s=>f.value=!1)},{default:a(()=>[...e[14]||(e[14]=[u("Cancel",-1)])]),_:1}),l(m,{type:"primary",onClick:K,loading:k.value},{default:a(()=>[...e[15]||(e[15]=[u("Save",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(te,{model:r,rules:H,ref_key:"userFormRef",ref:x,"label-width":"100px"},{default:a(()=>[l(b,{label:"Username",prop:"username"},{default:a(()=>[l(V,{modelValue:r.username,"onUpdate:modelValue":e[1]||(e[1]=s=>r.username=s),disabled:!!y.value},null,8,["modelValue","disabled"])]),_:1}),l(b,{label:"Email",prop:"email"},{default:a(()=>[l(V,{modelValue:r.email,"onUpdate:modelValue":e[2]||(e[2]=s=>r.email=s)},null,8,["modelValue"])]),_:1}),y.value?B("",!0):(p(),U(b,{key:0,label:"Password",prop:"password"},{default:a(()=>[l(V,{modelValue:r.password,"onUpdate:modelValue":e[3]||(e[3]=s=>r.password=s),type:"password","show-password":""},null,8,["modelValue"])]),_:1})),l(b,{label:"Roles",prop:"roles"},{default:a(()=>[l(ae,{modelValue:r.roles,"onUpdate:modelValue":e[4]||(e[4]=s=>r.roles=s),multiple:"",placeholder:"Select roles",style:{width:"100%"}},{default:a(()=>[l(N,{label:"ADMIN",value:"ADMIN"}),l(N,{label:"USER",value:"USER"})]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"Enabled"},{default:a(()=>[l(se,{modelValue:r.enabled,"onUpdate:modelValue":e[5]||(e[5]=s=>r.enabled=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l($,{modelValue:C.value,"onUpdate:modelValue":e[11]||(e[11]=s=>C.value=s),title:`Repository Permissions - ${(M=_.value)==null?void 0:M.username}`,width:"600px"},{default:a(()=>[R("div",ze,[l(V,{modelValue:o.repository,"onUpdate:modelValue":e[8]||(e[8]=s=>o.repository=s),placeholder:"Repository name",style:{width:"200px","margin-right":"10px"}},null,8,["modelValue"]),l(T,{modelValue:o.canPull,"onUpdate:modelValue":e[9]||(e[9]=s=>o.canPull=s)},{default:a(()=>[...e[16]||(e[16]=[u("Pull",-1)])]),_:1},8,["modelValue"]),l(T,{modelValue:o.canPush,"onUpdate:modelValue":e[10]||(e[10]=s=>o.canPush=s),style:{margin:"0 10px"}},{default:a(()=>[...e[17]||(e[17]=[u("Push",-1)])]),_:1},8,["modelValue"]),l(m,{type:"primary",onClick:X,icon:v(q)},{default:a(()=>[...e[18]||(e[18]=[u("Add",-1)])]),_:1},8,["icon"])]),l(F,{data:S.value,style:{width:"100%","margin-top":"20px"}},{default:a(()=>[l(i,{prop:"repositoryName",label:"Repository"}),l(i,{label:"Permissions",width:"150"},{default:a(({row:s})=>[s.canPull?(p(),U(P,{key:0,type:"success",size:"small"},{default:a(()=>[...e[19]||(e[19]=[u("Pull",-1)])]),_:1})):B("",!0),s.canPush?(p(),U(P,{key:1,type:"primary",size:"small",style:{"margin-left":"5px"}},{default:a(()=>[...e[20]||(e[20]=[u("Push",-1)])]),_:1})):B("",!0)]),_:1}),l(i,{label:"Actions",width:"100"},{default:a(({row:s})=>[l(m,{size:"small",type:"danger",onClick:g=>Y(s)},{default:a(()=>[l(w,null,{default:a(()=>[l(v(j))]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue","title"])])}}},Ge=he(Se,[["__scopeId","data-v-c81d629d"]]);export{Ge as default};
