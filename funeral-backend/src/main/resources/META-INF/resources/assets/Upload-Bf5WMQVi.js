import{r as y,I as z,c as p,a as i,b as a,f as l,g as t,e as I,J as K,E as Q,u as V,K as X,h as n,j as Y,L as Z,M as ee,N as le,t as u,O as te,d as W,s as se,l as ae,B as oe,F as ne,A as de,H as re,P as ue,C as ie,D as A,Q as pe,R as ce,n as b,S as fe}from"./index-BKVBmhn8.js";/* empty css                     */import{_ as me}from"./_plugin-vue_export-helper-sTCA9qUK.js";/* empty css                *//* empty css               *//* empty css                    *//* empty css                *//* empty css                 */const _e={class:"upload-container"},ve={class:"card-header"},ge={class:"upload-section"},ye={class:"upload-actions"},be={key:0,class:"upload-result"},he={key:0,class:"batch-summary"},we={key:1},Ue={key:0,class:"file-results"},ke={key:0},Fe={key:1},Ee={key:1,class:"result-details"},Ie={key:0,class:"manifest-list"},ze={class:"upload-content"},Ve={class:"step"},Te={class:"step-content"},Ce={class:"step"},De={class:"step-content"},Se={class:"step"},$e={class:"step-content"},Re={__name:"Upload",setup(xe){const H=y(),v=y([]),T=y(!1),o=y(null),h=y("my-app"),w=y("latest"),C=z(()=>{const{hostname:d,port:e}=window.location;return e&&e!=="80"?`${d}:${e}`:d}),D=z(()=>`docker tag ${h.value}:${w.value} ${C.value}/${h.value}:${w.value}`),S=z(()=>`docker push ${C.value}/${h.value}:${w.value}`),$=z(()=>`docker login ${C.value}`),M=d=>d.name.endsWith(".tar")||d.name.endsWith(".tar.gz")||d.name.endsWith(".tgz")||d.name.endsWith(".tar.zst")||d.name.endsWith(".zip")?!0:(b.error("Only .tar, .tar.gz, .tgz, .tar.zst, and .zip files are supported"),!1),j=()=>{o.value=null},q=async()=>{if(v.value.length===0){b.warning("Please select at least one file");return}T.value=!0,o.value=null;try{const d=new FormData;v.value.forEach(U=>{d.append("files",U.raw)});const e=fe(),c=e.getAuthHeader(),m={};c&&(m.Authorization=c);const g=await fetch("/funeral_addition/write/upload/dockertar/batch",{method:"POST",headers:m,body:d,credentials:"include"});if(g.status===401)throw e.logout(),new Error("Authentication required. Please log in.");if(!g.ok)throw new Error(`Upload failed: ${g.statusText}`);const r=await g.json();if(r.totalFiles){if(o.value={success:r.failedUploads===0,repositories:r.repositories||[],manifests:r.manifests||[],blobs:r.blobs||[],batchInfo:{totalFiles:r.totalFiles,successfulUploads:r.successfulUploads,failedUploads:r.failedUploads,results:r.results}},r.failedUploads>0){const U=r.results.filter(f=>!f.success);console.error("Failed files:",U)}}else o.value={success:!0,...r};v.value=[],b.success(`Successfully uploaded ${r.successfulUploads||1} files!`)}catch(d){console.error("Upload error:",d),o.value={success:!1,error:d.message},b.error(d.message||"Upload failed")}finally{T.value=!1}},R=async d=>{try{await navigator.clipboard.writeText(d),b.success("Copied to clipboard")}catch{b.error("Failed to copy to clipboard")}};return(d,e)=>{const c=te,m=Q,g=K,r=Y,U=Z,f=le,B=ee,_=ae,k=oe,N=se,x=re,G=ue,F=ie,P=ce,J=pe;return i(),p("div",_e,[e[27]||(e[27]=a("div",{class:"page-header"},[a("h1",null,"Upload Image")],-1)),l(x,{class:"upload-tar-card"},{header:t(()=>[a("div",ve,[e[10]||(e[10]=a("span",null,"ðŸ“¦ Upload Docker Tar File",-1)),l(c,{type:"success"},{default:t(()=>[...e[9]||(e[9]=[n("New Feature",-1)])]),_:1})])]),default:t(()=>[a("div",ge,[l(g,{ref_key:"uploadRef",ref:H,"file-list":v.value,"onUpdate:fileList":e[0]||(e[0]=s=>v.value=s),class:"tar-uploader",drag:"",action:"#",accept:".tar,.tar.gz,.tgz,.tar.zst,.zip","auto-upload":!1,"before-upload":M,"on-remove":j,multiple:""},{tip:t(()=>[...e[11]||(e[11]=[a("div",{class:"el-upload__tip"},[n(" Supports: .tar, .tar.gz, .tgz, .tar.zst, and .zip (containing tar files)"),a("br"),n(" Use "),a("code",null,"docker save image:tag -o image.tar"),n(" to create tar file ")],-1)])]),default:t(()=>[l(m,{class:"el-icon--upload"},{default:t(()=>[l(V(X))]),_:1}),e[12]||(e[12]=a("div",{class:"el-upload__text"},[n(" Drop Docker tar file here or "),a("em",null,"click to upload")],-1))]),_:1},8,["file-list"]),a("div",ye,[l(r,{type:"primary",loading:T.value,disabled:v.value.length===0,onClick:q},{default:t(()=>[...e[13]||(e[13]=[n(" Upload and Analyze ",-1)])]),_:1},8,["loading","disabled"])]),o.value?(i(),p("div",be,[l(U,{title:o.value.success?"Upload successful!":"Upload failed",type:o.value.success?"success":"error",closable:!1,"show-icon":""},null,8,["title","type"]),o.value.batchInfo?(i(),p("div",he,[e[15]||(e[15]=a("h4",null,"ðŸ“Š Batch Upload Summary:",-1)),l(B,{column:3,border:""},{default:t(()=>[l(f,{label:"Total Files"},{default:t(()=>[n(u(o.value.batchInfo.totalFiles),1)]),_:1}),l(f,{label:"Successful"},{default:t(()=>[l(c,{type:"success"},{default:t(()=>[n(u(o.value.batchInfo.successfulUploads),1)]),_:1})]),_:1}),l(f,{label:"Failed"},{default:t(()=>[o.value.batchInfo.failedUploads>0?(i(),W(c,{key:0,type:"danger"},{default:t(()=>[n(u(o.value.batchInfo.failedUploads),1)]),_:1})):(i(),p("span",we,"0"))]),_:1})]),_:1}),o.value.batchInfo.results&&o.value.batchInfo.results.length>0?(i(),p("div",Ue,[e[14]||(e[14]=a("h4",null,"ðŸ“ Individual File Results:",-1)),l(N,{data:o.value.batchInfo.results,border:"",stripe:"",style:{width:"100%"}},{default:t(()=>[l(_,{label:"#",width:"60"},{default:t(s=>[n(u(s.row.fileIndex),1)]),_:1}),l(_,{label:"Status",width:"100"},{default:t(s=>[l(c,{type:s.row.success?"success":"danger"},{default:t(()=>[n(u(s.row.success?"Success":"Failed"),1)]),_:2},1032,["type"])]),_:1}),l(_,{label:"Details"},{default:t(s=>[s.row.success&&s.row.uploadResponse?(i(),p("div",ke,[l(k,{type:"success"},{default:t(()=>{var E,L,O;return[n(u(((E=s.row.uploadResponse.repositories)==null?void 0:E.length)||0)+" repositories, "+u(((L=s.row.uploadResponse.manifests)==null?void 0:L.length)||0)+" manifests, "+u(((O=s.row.uploadResponse.blobs)==null?void 0:O.length)||0)+" blobs ",1)]}),_:2},1024)])):(i(),p("div",Fe,[l(k,{type:"danger"},{default:t(()=>[n(u(s.row.error),1)]),_:2},1024)]))]),_:1})]),_:1},8,["data"])])):I("",!0)])):I("",!0),o.value.repositories?(i(),p("div",Ee,[e[17]||(e[17]=a("h4",null,"ðŸ“Š Analysis Results:",-1)),l(B,{column:1,border:""},{default:t(()=>[l(f,{label:"Repositories Found"},{default:t(()=>[(i(!0),p(ne,null,de(o.value.repositories,s=>(i(),W(c,{key:s,type:"info",class:"result-tag"},{default:t(()=>[n(u(s),1)]),_:2},1024))),128))]),_:1}),l(f,{label:"Manifests"},{default:t(()=>{var s;return[n(u(((s=o.value.manifests)==null?void 0:s.length)||0),1)]}),_:1}),l(f,{label:"Blobs"},{default:t(()=>{var s;return[n(u(((s=o.value.blobs)==null?void 0:s.length)||0),1)]}),_:1})]),_:1}),o.value.manifests?(i(),p("div",Ie,[e[16]||(e[16]=a("h4",null,"ðŸ“‹ Image Tags Found:",-1)),l(N,{data:o.value.manifests,border:"",stripe:"",style:{width:"100%"}},{default:t(()=>[l(_,{prop:"repository",label:"Repository"}),l(_,{prop:"tag",label:"Tag"}),l(_,{prop:"configDigest",label:"Config Digest","show-overflow-tooltip":""}),l(_,{label:"Layers",width:"100"},{default:t(s=>[l(c,{size:"small"},{default:t(()=>{var E;return[n(u(((E=s.row.layerDigests)==null?void 0:E.length)||0),1)]}),_:2},1024)]),_:1})]),_:1},8,["data"])])):I("",!0)])):I("",!0)])):I("",!0)])]),_:1}),l(G,{"content-position":"center"},{default:t(()=>[...e[18]||(e[18]=[n("OR",-1)])]),_:1}),l(x,{class:"upload-card"},{header:t(()=>[...e[19]||(e[19]=[a("div",{class:"card-header"},[a("span",null,"Docker Push Guide")],-1)])]),default:t(()=>[a("div",ze,[a("div",Ve,[e[21]||(e[21]=a("h3",null,"Step 1: Tag your image",-1)),a("div",Te,[l(k,{type:"info"},{default:t(()=>[...e[20]||(e[20]=[n("Use the following command to tag your Docker image:",-1)])]),_:1}),l(F,{modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=s=>D.value=s),readonly:"",class:"command-input"},{append:t(()=>[l(r,{onClick:e[1]||(e[1]=s=>R(D.value))},{default:t(()=>[l(m,null,{default:t(()=>[l(V(A))]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),a("div",Ce,[e[23]||(e[23]=a("h3",null,"Step 2: Push to registry",-1)),a("div",De,[l(k,{type:"info"},{default:t(()=>[...e[22]||(e[22]=[n("Then push the tagged image to this registry:",-1)])]),_:1}),l(F,{modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=s=>S.value=s),readonly:"",class:"command-input"},{append:t(()=>[l(r,{onClick:e[3]||(e[3]=s=>R(S.value))},{default:t(()=>[l(m,null,{default:t(()=>[l(V(A))]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),a("div",Se,[e[25]||(e[25]=a("h3",null,"Step 3: Authenticate (Optional)",-1)),a("div",$e,[l(k,{type:"info"},{default:t(()=>[...e[24]||(e[24]=[n("If authentication is required, login first:",-1)])]),_:1}),l(F,{modelValue:$.value,"onUpdate:modelValue":e[6]||(e[6]=s=>$.value=s),readonly:"",class:"command-input"},{append:t(()=>[l(r,{onClick:e[5]||(e[5]=s=>R($.value))},{default:t(()=>[l(m,null,{default:t(()=>[l(V(A))]),_:1})]),_:1})]),_:1},8,["modelValue"])])])])]),_:1}),l(x,{class:"config-card"},{header:t(()=>[...e[26]||(e[26]=[a("div",{class:"card-header"},[a("span",null,"Configuration")],-1)])]),default:t(()=>[l(J,{"label-width":"120px"},{default:t(()=>[l(P,{label:"Repository Name"},{default:t(()=>[l(F,{modelValue:h.value,"onUpdate:modelValue":e[7]||(e[7]=s=>h.value=s),placeholder:"my-app"},null,8,["modelValue"])]),_:1}),l(P,{label:"Image Tag"},{default:t(()=>[l(F,{modelValue:w.value,"onUpdate:modelValue":e[8]||(e[8]=s=>w.value=s),placeholder:"latest"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])}}},Me=me(Re,[["__scopeId","data-v-c071b399"]]);export{Me as default};
