import{aa as Y,r as U,ag as Z,N as T,c as V,o as w,a as o,d as t,g as ee,b as te,w as r,ae as re,af as oe,aj as le,ak as ae,s as n,J as se,ah as ne,j as ie,u as C,ai as x,t as _,ad as ue,R as de,l as pe,am as me,L as ce,i as fe,S as ge,T as _e,I as ye,K as he,an as ve,as as be,at as Ce,ao as we,ap as Re,aq as Ve,ar as xe,C as E,z as Ee}from"./index-Y3_aSSC5.js";/* empty css                  *//* empty css                */import{_ as Me}from"./el-input-BtvPs5Ei.js";/* empty css                     *//* empty css                 *//* empty css                   *//* empty css                  */const Ie="/oci-icon.png",Te="/helm-icon.png",Pe={class:"mirror-helm-container"},ke={class:"card-header"},Ne={class:"form-tip"},He={key:0},Oe={key:1},Se={class:"form-tip"},Fe={class:"mirror-helm-actions"},Ue={key:0,class:"result-success"},Ae={class:"result-details"},ze={class:"result-actions"},De={key:1,class:"result-error"},$e={class:"help-content"},qe={__name:"MirrorHelm",setup(Le){const A=Ee(),k=Y(),R=U(!1),a=U(null),l=Z({format:"oci",sourceRepo:"",chartName:"",version:"",targetRepository:"",targetVersion:"",username:"",password:""}),z={sourceRepo:[{required:!0,message:"Please enter source repository",trigger:"blur"}],chartName:[{required:!0,message:"Please enter chart name",trigger:"blur"}],format:[{required:!0,message:"Please select repository format",trigger:"change"}]},D=T(()=>l.format==="oci"?"registry-1.docker.io or myregistry.azurecr.io":"https://charts.helm.sh/stable"),$=T(()=>l.format==="oci"?"OCI registry hostname (e.g., docker.io, myregistry.azurecr.io)":"ChartMuseum repository URL (e.g., https://charts.example.com)"),q=T(()=>l.format==="oci"?"OCI registry hostname without protocol":"Full URL with protocol for ChartMuseum"),L=()=>{l.sourceRepo=""},B=async()=>{var m,e,d,f,y,p,c,g;if(!l.chartName||!l.sourceRepo){E.error("Please complete required fields");return}R.value=!0,a.value=null;try{const s=new URLSearchParams;s.append("sourceRepo",l.sourceRepo.trim()),s.append("chartName",l.chartName.trim()),(m=l.version)!=null&&m.trim()&&s.append("version",l.version.trim()),(e=l.targetRepository)!=null&&e.trim()?s.append("targetRepository",l.targetRepository.trim()):s.append("targetRepository",l.chartName.trim()),(d=l.targetVersion)!=null&&d.trim()?s.append("targetVersion",l.targetVersion.trim()):(f=l.version)!=null&&f.trim()&&s.append("targetVersion",l.version.trim()),s.append("format",l.format||"oci"),(y=l.username)!=null&&y.trim()&&s.append("username",l.username.trim()),(p=l.password)!=null&&p.trim()&&s.append("password",l.password.trim());const M=k.getAuthHeader(),h={"Content-Type":"application/x-www-form-urlencoded"};M&&(h.Authorization=M);const v=await fetch("/funeral_addition/mirror/helm/pull",{method:"POST",headers:h,body:s,credentials:"include"});if(v.status===401)throw k.logout(),new Error("Authentication required. Please log in.");if(!v.ok){const i=((g=(c=(await v.json()).errors)==null?void 0:c[0])==null?void 0:g.message)||`Mirror failed: ${v.statusText}`;throw new Error(i)}const b=await v.json();a.value={success:!0,...b},E.success(`Successfully mirrored ${b.chart||l.chartName}!`)}catch(s){console.error("Mirror error:",s),a.value={success:!1,error:s.message||"Mirror failed"},E.error(s.message||"Mirror failed")}finally{R.value=!1}},j=()=>{l.sourceRepo="",l.chartName="",l.version="",l.targetRepository="",l.targetVersion="",l.username="",l.password="",l.format="oci",a.value=null},W=()=>{var m;(m=a.value)!=null&&m.targetChart&&A.push(`/repository/${a.value.targetChart}`)},N=T(()=>{var f,y;if(!((f=a.value)!=null&&f.targetChart)||!((y=a.value)!=null&&y.targetVersion))return"";const{hostname:m,port:e}=window.location,d=e&&e!=="80"?`${m}:${e}`:m;return a.value.format==="oci"?`helm pull oci://${d}/${a.value.targetChart} --version ${a.value.targetVersion}`:`helm repo add myrepo http://${d} && helm repo update && helm install myrelease ${a.value.targetChart} --version ${a.value.targetVersion}`}),J=async()=>{if(N.value)try{await navigator.clipboard.writeText(N.value),E.success("Helm command copied to clipboard")}catch{E.error("Failed to copy to clipboard")}};return(m,e)=>{const d=ce,f=ae,y=le,p=oe,c=ie,g=ne,s=se,M=ue,h=de,v=re,b=pe,I=fe,i=_e,Q=ye,P=ge,H=ve,O=Ce,K=be,S=Re,F=xe,G=Ve,X=we;return w(),V("div",Pe,[e[38]||(e[38]=o("div",{class:"page-header"},[o("h1",null,"ðŸŽµ Mirror Helm Chart"),o("p",{class:"subtitle"},"Pull Helm charts from external repositories directly to this registry")],-1)),t(I,{class:"mirror-helm-card"},{header:r(()=>[o("div",ke,[e[9]||(e[9]=o("span",null,"ðŸ“¦ Pull Helm Chart from External Repository",-1)),t(d,{type:"success"},{default:r(()=>[...e[8]||(e[8]=[n("New Feature",-1)])]),_:1})])]),default:r(()=>[t(v,{ref:"mirrorHelmForm",model:l,rules:z,"label-width":"160px",class:"mirror-helm-form"},{default:r(()=>[t(p,{label:"Repository Format",prop:"format"},{default:r(()=>[t(y,{modelValue:l.format,"onUpdate:modelValue":e[0]||(e[0]=u=>l.format=u),style:{width:"100%"},onChange:L},{default:r(()=>[t(f,{label:"OCI Registry",value:"oci"},{default:r(()=>[...e[10]||(e[10]=[o("div",{style:{display:"flex","align-items":"center"}},[o("img",{src:Ie,alt:"OCI",style:{width:"16px",height:"16px","margin-right":"8px"}}),n(" OCI Registry (Recommended) ")],-1)])]),_:1}),t(f,{label:"ChartMuseum",value:"chartmuseum"},{default:r(()=>[...e[11]||(e[11]=[o("div",{style:{display:"flex","align-items":"center"}},[o("img",{src:Te,alt:"Helm",style:{width:"16px",height:"16px","margin-right":"8px"}}),n(" ChartMuseum (Traditional) ")],-1)])]),_:1})]),_:1},8,["modelValue"]),o("div",Ne,[l.format==="oci"?(w(),V("span",He,"OCI format stores charts as OCI artifacts")):(w(),V("span",Oe,"ChartMuseum format uses HTTP API for chart management"))])]),_:1}),t(p,{label:"Source Repository",prop:"sourceRepo"},{default:r(()=>[t(s,{modelValue:l.sourceRepo,"onUpdate:modelValue":e[1]||(e[1]=u=>l.sourceRepo=u),placeholder:D.value,clearable:""},{append:r(()=>[t(g,{content:$.value,placement:"top"},{default:r(()=>[t(c,null,{default:r(()=>[t(C(x))]),_:1})]),_:1},8,["content"])]),_:1},8,["modelValue","placeholder"]),o("div",Se,_(q.value),1)]),_:1}),t(p,{label:"Chart Name",prop:"chartName"},{default:r(()=>[t(s,{modelValue:l.chartName,"onUpdate:modelValue":e[2]||(e[2]=u=>l.chartName=u),placeholder:"nginx",clearable:""},{append:r(()=>[t(g,{content:"e.g., nginx, mysql, prometheus"},{default:r(()=>[t(c,null,{default:r(()=>[t(C(x))]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[12]||(e[12]=o("div",{class:"form-tip"},"Name of the Helm chart to pull",-1))]),_:1}),t(p,{label:"Chart Version",prop:"version"},{default:r(()=>[t(s,{modelValue:l.version,"onUpdate:modelValue":e[3]||(e[3]=u=>l.version=u),placeholder:"latest",clearable:""},{append:r(()=>[t(g,{content:"Chart version or 'latest'"},{default:r(()=>[t(c,null,{default:r(()=>[t(C(x))]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[13]||(e[13]=o("div",{class:"form-tip"},"Version of the chart (e.g., 1.2.3)",-1))]),_:1}),t(p,{label:"Target Repository",prop:"targetRepository"},{default:r(()=>[t(s,{modelValue:l.targetRepository,"onUpdate:modelValue":e[4]||(e[4]=u=>l.targetRepository=u),placeholder:l.chartName||"my-chart",clearable:""},{append:r(()=>[t(g,{content:"Repository name in this registry"},{default:r(()=>[t(c,null,{default:r(()=>[t(C(x))]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),e[14]||(e[14]=o("div",{class:"form-tip"},"Repository name in this registry (defaults to chart name)",-1))]),_:1}),t(p,{label:"Target Version",prop:"targetVersion"},{default:r(()=>[t(s,{modelValue:l.targetVersion,"onUpdate:modelValue":e[5]||(e[5]=u=>l.targetVersion=u),placeholder:l.version||"latest",clearable:""},{append:r(()=>[t(g,{content:"Version to use in this registry"},{default:r(()=>[t(c,null,{default:r(()=>[t(C(x))]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),e[15]||(e[15]=o("div",{class:"form-tip"},"Version for the mirrored chart (defaults to source version)",-1))]),_:1}),t(M,{"content-position":"left"},{default:r(()=>[...e[16]||(e[16]=[n("Authentication (Optional)",-1)])]),_:1}),t(h,{title:"Leave empty for public repositories. For private repositories, provide credentials.",type:"info",closable:!1,"show-icon":"",class:"auth-alert"}),t(p,{label:"Username"},{default:r(()=>[t(s,{modelValue:l.username,"onUpdate:modelValue":e[6]||(e[6]=u=>l.username=u),placeholder:"repository username",clearable:""},null,8,["modelValue"])]),_:1}),t(p,{label:"Password"},{default:r(()=>[t(s,{modelValue:l.password,"onUpdate:modelValue":e[7]||(e[7]=u=>l.password=u),type:"password",placeholder:"repository password","show-password":"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),o("div",Fe,[t(b,{type:"primary",size:"large",loading:R.value,disabled:!l.chartName||R.value,onClick:B},{default:r(()=>[t(c,null,{default:r(()=>[t(C(me))]),_:1}),e[17]||(e[17]=n(" Start Mirroring ",-1))]),_:1},8,["loading","disabled"]),t(b,{onClick:j,disabled:R.value},{default:r(()=>[...e[18]||(e[18]=[n(" Reset ",-1)])]),_:1},8,["disabled"])])]),_:1}),a.value?(w(),ee(I,{key:0,class:"result-card"},{header:r(()=>[...e[19]||(e[19]=[o("div",{class:"card-header"},[o("span",null,"ðŸ“Š Mirror Result")],-1)])]),default:r(()=>[a.value.success?(w(),V("div",Ue,[t(H,{icon:"success",title:"Mirror Successful"},{subTitle:r(()=>[o("div",Ae,[t(P,{column:1,border:""},{default:r(()=>[t(i,{label:"Source"},{default:r(()=>[t(d,{type:"info"},{default:r(()=>[n(_(a.value.source),1)]),_:1})]),_:1}),t(i,{label:"Chart"},{default:r(()=>[t(d,{type:"success"},{default:r(()=>[n(_(a.value.chart)+":"+_(a.value.version),1)]),_:1})]),_:1}),t(i,{label:"Target"},{default:r(()=>[t(d,{type:"success"},{default:r(()=>[n(_(a.value.targetChart)+":"+_(a.value.targetVersion),1)]),_:1})]),_:1}),t(i,{label:"Format"},{default:r(()=>[t(d,{type:"info"},{default:r(()=>[n(_(a.value.format==="oci"?"OCI":"ChartMuseum"),1)]),_:1})]),_:1}),t(i,{label:"Digest"},{default:r(()=>[t(Q,{tag:"code",size:"small"},{default:r(()=>[n(_(a.value.digest),1)]),_:1})]),_:1})]),_:1}),o("div",ze,[t(b,{type:"primary",onClick:W},{default:r(()=>[...e[20]||(e[20]=[n(" View Repository ",-1)])]),_:1}),t(b,{onClick:J},{default:r(()=>[t(c,null,{default:r(()=>[t(C(he))]),_:1}),e[21]||(e[21]=n(" Copy Helm Install Command ",-1))]),_:1})])])]),_:1})])):(w(),V("div",De,[t(H,{icon:"error",title:"Mirror Failed"},{subTitle:r(()=>[t(h,{title:a.value.error,type:"error",closable:!1,"show-icon":""},null,8,["title"])]),_:1})]))]),_:1})):te("",!0),t(I,{class:"help-card"},{header:r(()=>[...e[22]||(e[22]=[o("div",{class:"card-header"},[o("span",null,"ðŸ’¡ Help & Examples")],-1)])]),default:r(()=>[t(K,{type:"border-card"},{default:r(()=>[t(O,{label:"OCI Repository"},{default:r(()=>[e[27]||(e[27]=o("h4",null,"ðŸ“¦ OCI Registry Examples",-1)),e[28]||(e[28]=o("p",null,"OCI format stores Helm charts as OCI artifacts in container registries.",-1)),t(P,{column:1,border:"",class:"example-table"},{default:r(()=>[t(i,{label:"Docker Hub"},{default:r(()=>[...e[23]||(e[23]=[o("code",null,"registry-1.docker.io",-1),n(" or ",-1),o("code",null,"docker.io",-1)])]),_:1}),t(i,{label:"Azure Container Registry"},{default:r(()=>[...e[24]||(e[24]=[o("code",null,"myregistry.azurecr.io",-1)])]),_:1}),t(i,{label:"AWS ECR"},{default:r(()=>[...e[25]||(e[25]=[o("code",null,"account-id.dkr.ecr.region.amazonaws.com",-1)])]),_:1}),t(i,{label:"Private Registry"},{default:r(()=>[...e[26]||(e[26]=[o("code",null,"registry.example.com",-1)])]),_:1})]),_:1}),t(h,{title:"OCI format uses the pattern: <registry>/<chart>:<version>",type:"info",closable:!1,"show-icon":"",style:{"margin-top":"10px"}})]),_:1}),t(O,{label:"ChartMuseum"},{default:r(()=>[e[33]||(e[33]=o("h4",null,"ðŸŽ« ChartMuseum Examples",-1)),e[34]||(e[34]=o("p",null,"ChartMuseum provides traditional HTTP API for Helm chart management.",-1)),t(P,{column:1,border:"",class:"example-table"},{default:r(()=>[t(i,{label:"Public Repository"},{default:r(()=>[...e[29]||(e[29]=[o("code",null,"https://charts.helm.sh/stable",-1)])]),_:1}),t(i,{label:"Harbor ChartMuseum"},{default:r(()=>[...e[30]||(e[30]=[o("code",null,"https://harbor.example.com/chartrepo/library",-1)])]),_:1}),t(i,{label:"JFrog Artifactory"},{default:r(()=>[...e[31]||(e[31]=[o("code",null,"https://artifactory.example.com/artifactory/helm-local",-1)])]),_:1}),t(i,{label:"Private Server"},{default:r(()=>[...e[32]||(e[32]=[o("code",null,"https://charts.example.com",-1)])]),_:1})]),_:1}),t(h,{title:"ChartMuseum API endpoints typically end with /charts/<name>-<version>.tgz",type:"info",closable:!1,"show-icon":"",style:{"margin-top":"10px"}})]),_:1})]),_:1}),t(X,{style:{"margin-top":"20px"}},{default:r(()=>[t(S,{title:"ðŸ“– How it works",name:"1"},{default:r(()=>[...e[35]||(e[35]=[o("div",{class:"help-content"},[o("p",null,"1. Choose the repository format (OCI or ChartMuseum)"),o("p",null,"2. Enter the source repository URL and chart details"),o("p",null,"3. Optional: Customize the target repository name and version"),o("p",null,"4. For private repositories, provide credentials"),o("p",null,"5. The service will pull the chart and store it in this registry")],-1)])]),_:1}),t(S,{title:"ðŸ“ Popular Charts",name:"2"},{default:r(()=>[o("div",$e,[t(G,{gutter:20},{default:r(()=>[t(F,{span:12},{default:r(()=>[...e[36]||(e[36]=[o("h4",null,"Web Applications",-1),o("ul",null,[o("li",null,[o("code",null,"nginx"),n(" - Web server")]),o("li",null,[o("code",null,"wordpress"),n(" - CMS platform")]),o("li",null,[o("code",null,"drupal"),n(" - CMS platform")])],-1)])]),_:1}),t(F,{span:12},{default:r(()=>[...e[37]||(e[37]=[o("h4",null,"Databases",-1),o("ul",null,[o("li",null,[o("code",null,"postgresql"),n(" - PostgreSQL")]),o("li",null,[o("code",null,"mysql"),n(" - MySQL")]),o("li",null,[o("code",null,"mongodb"),n(" - MongoDB")])],-1)])]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1})])}}},Ye=Me(qe,[["__scopeId","data-v-f2b7a2a8"]]);export{Ye as default};
