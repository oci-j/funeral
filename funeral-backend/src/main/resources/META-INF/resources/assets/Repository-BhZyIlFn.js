import{r as g,D as z,m as J,c as b,o as w,a as i,g as F,b as N,d as n,t as p,w as o,s as c,j as O,u as C,G as q,l as Q,F as W,H as X,h as Y,B as $,C as v,z as Z,I as ee,J as te,K as ae,L as ne,M as oe,N as se,i as le,A as re}from"./index-CarGvsjG.js";/* empty css                 */import{_ as ie}from"./el-input-BtvPs5Ei.js";/* empty css                */import{u as ce}from"./useAuthCheck-fWfCycac.js";const de={class:"repository-container"},ue={class:"page-header"},me={class:"card-header"},fe={class:"tag-header-info"},pe={class:"tag-name"},_e={class:"header-actions"},ye={class:"tag-details"},ge={class:"detail-item"},ve={class:"detail-item"},Te={class:"pull-command"},he={__name:"Repository",setup(ke){const M=z(),x=Z(),u=g(decodeURIComponent(M.params.name)),_=g([]),B=g({}),T=g(!1),D=g(null),R=async()=>{T.value=!0;try{const e=await $.getRepositoryTags(u.value);if(e.tags){const t=await Promise.allSettled(e.tags.map(async a=>{try{const l=await $.getManifestInfo(u.value,a),d=await $.getManifest(u.value,a);return B.value[a]=d,{name:a,digest:l.digest||"Unknown",size:l.contentLength||"Unknown",created:l.createdAt||"Unknown"}}catch{return{name:a,digest:"Unknown",size:"Unknown",created:"Unknown"}}}));_.value=t.filter(a=>a.status==="fulfilled").map(a=>a.value)}else _.value=[]}catch(e){v.error("Failed to fetch repository tags"),console.error("Error fetching repository tags:",e)}finally{T.value=!1}},I=e=>E(e.name)?`helm pull oci://${window.location.hostname}:${window.location.port||80}/${u.value} --version ${e.name}`:`docker pull ${window.location.hostname}:${window.location.port||80}/${u.value}:${e.name}`,E=e=>{var a,l,d,r,m;const t=B.value[e];return t?(l=(a=t.config)==null?void 0:a.mediaType)!=null&&l.includes("helm")?!0:((d=t.layers)==null?void 0:d.length)>0?t.layers.some(f=>f.mediaType&&f.mediaType.includes("helm")):!!((r=t.mediaType)!=null&&r.includes("helm")||(m=t.artifactType)!=null&&m.includes("helm")):!1},P=e=>{var a,l,d,r,m,f,h,s,y;const t=B.value[e];return t?(l=(a=t.config)==null?void 0:a.mediaType)!=null&&l.includes("image")||(r=(d=t.config)==null?void 0:d.mediaType)!=null&&r.includes("container")?!0:((m=t.layers)==null?void 0:m.length)>0?t.layers.some(k=>k.mediaType&&(k.mediaType.includes("image")||k.mediaType.includes("rootfs")||k.mediaType.includes("docker"))):!!((f=t.mediaType)!=null&&f.includes("image")||(h=t.mediaType)!=null&&h.includes("docker")||(s=t.artifactType)!=null&&s.includes("image")||(y=t.artifactType)!=null&&y.includes("docker")):!1},U=e=>E(e)?"helm":P(e)?"docker":"unknown",A=e=>{switch(U(e)){case"helm":return"Helm Chart";case"docker":return"Docker Image";default:return"OCI Artifact"}},H=e=>{switch(U(e)){case"helm":return"success";case"docker":return"info";default:return"warning"}},V=async e=>{try{await navigator.clipboard.writeText(e),v.success("Copied to clipboard")}catch{v.error("Failed to copy to clipboard")}},L=e=>e==="Unknown"?e:e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(2)} KB`:e<1024*1024*1024?`${(e/(1024*1024)).toFixed(2)} MB`:`${(e/(1024*1024*1024)).toFixed(2)} GB`,S=async e=>{try{await re.confirm(`Are you sure you want to delete tag "${e}"?`,"Delete Tag",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}),D.value=e,await $.deleteTag(u.value,e),v.success(`Tag "${e}" deleted successfully`),_.value=_.value.filter(t=>t.name!==e)}catch(t){t!=="cancel"&&v.error(`Failed to delete tag "${e}": ${t.message}`)}finally{D.value=null}},G=e=>{x.push({name:"TagDetail",params:{name:u.value,tag:e}})},K=()=>{x.back()},{initPage:j}=ce(x,R,{loading:T});return J(()=>{j()}),(e,t)=>{const a=O,l=Q,d=ne,r=ee,m=te,f=le,h=Y;return w(),b("div",de,[i("div",ue,[i("h1",null,p(u.value),1),n(l,{onClick:K},{default:o(()=>[n(a,null,{default:o(()=>[n(C(q))]),_:1}),t[0]||(t[0]=c(" Back ",-1))]),_:1})]),(w(!0),b(W,null,X(_.value,s=>(w(),F(f,{class:"tag-card",key:s.name},{header:o(()=>[i("div",me,[i("div",fe,[i("span",pe,p(s.name),1),n(d,{type:H(s.name),size:"small"},{default:o(()=>[c(p(A(s.name)),1)]),_:2},1032,["type"])]),i("div",_e,[n(r,{type:"info",size:"small"},{default:o(()=>[c(p(L(s.size)),1)]),_:2},1024),n(l,{type:"primary",size:"small",onClick:y=>G(s.name)},{default:o(()=>[n(a,null,{default:o(()=>[n(C(oe))]),_:1}),t[1]||(t[1]=c(" Details ",-1))]),_:1},8,["onClick"]),n(l,{type:"danger",size:"small",onClick:y=>S(s.name),loading:D.value===s.name},{default:o(()=>[n(a,null,{default:o(()=>[n(C(se))]),_:1}),t[2]||(t[2]=c(" Delete ",-1))]),_:1},8,["onClick","loading"])])])]),default:o(()=>[i("div",ye,[i("div",ge,[n(r,{type:"info"},{default:o(()=>[...t[3]||(t[3]=[c("Created:",-1)])]),_:1}),n(r,null,{default:o(()=>[c(p(s.created||"Unknown"),1)]),_:2},1024)]),i("div",ve,[n(r,{type:"info"},{default:o(()=>[...t[4]||(t[4]=[c("Digest:",-1)])]),_:1}),n(r,{class:"digest-text"},{default:o(()=>[c(p(s.digest),1)]),_:2},1024)]),i("div",Te,[n(r,{type:"info"},{default:o(()=>[c(p(E(s.name)?"Helm Command:":"Pull Command:"),1)]),_:2},1024),n(m,{"model-value":I(s),readonly:"",class:"command-input"},{append:o(()=>[n(l,{onClick:y=>V(I(s))},{default:o(()=>[n(a,null,{default:o(()=>[n(C(ae))]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["model-value"])])])]),_:2},1024))),128)),!T.value&&_.value.length===0?(w(),F(h,{key:0,description:"No tags found"})):N("",!0)])}}},De=ie(he,[["__scopeId","data-v-83de2e0c"]]);export{De as default};
