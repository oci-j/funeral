// package.json
{
  "name": "oci-registry-frontend",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "vue": "^3.4.0",
    "vue-router": "^4.2.5",
    "axios": "^1.6.0",
    "pinia": "^2.1.7",
    "@headlessui/vue": "^1.7.16",
    "@heroicons/vue": "^2.0.18",
    "tailwindcss": "^3.3.6"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^4.5.0",
    "vite": "^5.0.0",
    "autoprefixer": "^10.4.16",
    "postcss": "^8.4.32"
  }
}

// vite.config.js
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [vue()],
  server: {
    proxy: {
      '/v2': {
        target: 'http://localhost:8080',
        changeOrigin: true
      }
    }
  }
})

// tailwind.config.js
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{vue,js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}

// postcss.config.js
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}

// src/main.js
import { createApp } from 'vue'
import { createPinia } from 'pinia'
import router from './router'
import App from './App.vue'
import './style.css'

const app = createApp(App)
app.use(createPinia())
app.use(router)
app.mount('#app')

// src/style.css
@import 'tailwindcss/base';
@import 'tailwindcss/components';
@import 'tailwindcss/utilities';

// src/App.vue
<template>
  <div id="app" class="min-h-screen bg-gray-50">
    <nav class="bg-white shadow-sm border-b">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
          <div class="flex items-center">
            <router-link to="/" class="flex items-center space-x-2">
              <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                <span class="text-white font-bold text-sm">OCI</span>
              </div>
              <span class="text-xl font-semibold text-gray-900">Registry</span>
            </router-link>
          </div>
          <div class="flex items-center space-x-4">
            <router-link
              to="/"
              class="text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium"
              :class="{ 'bg-gray-100 text-gray-900': $route.path === '/' }"
            >
              Repositories
            </router-link>
            <router-link
              to="/upload"
              class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium"
            >
              Upload
            </router-link>
          </div>
        </div>
      </div>
    </nav>

    <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
      <router-view />
    </main>
  </div>
</template>

<script>
export default {
  name: 'App'
}
</script>

// src/router/index.js
import { createRouter, createWebHistory } from 'vue-router'
import Home from '../views/Home.vue'
import Repository from '../views/Repository.vue'
import Upload from '../views/Upload.vue'

const routes = [
  {
    path: '/',
    name: 'Home',
    component: Home
  },
  {
    path: '/repository/:name',
    name: 'Repository',
    component: Repository,
    props: true
  },
  {
    path: '/upload',
    name: 'Upload',
    component: Upload
  }
]

const router = createRouter({
  history: createWebHistory(),
  routes
})

export default router

// src/stores/registry.js
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import registryAPI from '../api/registry'

export const useRegistryStore = defineStore('registry', () => {
  const repositories = ref([])
  const loading = ref(false)
  const error = ref(null)

  const repositoryCount = computed(() => repositories.value.length)

  async function fetchRepositories() {
    loading.value = true
    error.value = null
    try {
      repositories.value = await registryAPI.getRepositories()
    } catch (err) {
      error.value = err.message
    } finally {
      loading.value = false
    }
  }

  async function getRepository(name) {
    try {
      return await registryAPI.getRepository(name)
    } catch (err) {
      error.value = err.message
      throw err
    }
  }

  async function getTags(repositoryName) {
    try {
      return await registryAPI.getTags(repositoryName)
    } catch (err) {
      error.value = err.message
      throw err
    }
  }

  async function getManifest(repositoryName, reference) {
    try {
      return await registryAPI.getManifest(repositoryName, reference)
    } catch (err) {
      error.value = err.message
      throw err
    }
  }

  async function deleteManifest(repositoryName, reference) {
    try {
      await registryAPI.deleteManifest(repositoryName, reference)
      // Refresh repositories after deletion
      await fetchRepositories()
    } catch (err) {
      error.value = err.message
      throw err
    }
  }

  return {
    repositories,
    loading,
    error,
    repositoryCount,
    fetchRepositories,
    getRepository,
    getTags,
    getManifest,
    deleteManifest
  }
})

// src/api/registry.js
import axios from 'axios'

const api = axios.create({
  baseURL: '/v2',
  timeout: 30000
})

// Request interceptor
api.interceptors.request.use(
  config => {
    console.log(`Making ${config.method?.toUpperCase()} request to ${config.url}`)
    return config
  },
  error => {
    return Promise.reject(error)
  }
)

// Response interceptor
api.interceptors.response.use(
  response => response,
  error => {
    console.error('API Error:', error)
    if (error.response?.data?.errors) {
      const errorMessage = error.response.data.errors
        .map(err => `${err.code}: ${err.message}`)
        .join(', ')
      throw new Error(errorMessage)
    }
    throw error
  }
)

export default {
  // Check registry version
  async checkVersion() {
    const response = await api.get('/')
    return response.status === 200
  },

  // Get all repositories (this is a custom endpoint we'll need to add)
  async getRepositories() {
    try {
      const response = await api.get('/repositories')
      return response.data
    } catch (error) {
      // If custom endpoint doesn't exist, return empty array
      if (error.response?.status === 404) {
        return []
      }
      throw error
    }
  },

  // Get repository details
  async getRepository(name) {
    const response = await api.get(`/${name}/tags/list`)
    return response.data
  },

  // Get tags for a repository
  async getTags(repositoryName) {
    const response = await api.get(`/${repositoryName}/tags/list`)
    return response.data
  },

  // Get manifest
  async getManifest(repositoryName, reference) {
    const response = await api.get(`/${repositoryName}/manifests/${reference}`)
    return {
      content: response.data,
      digest: response.headers['docker-content-digest'],
      contentType: response.headers['content-type']
    }
  },

  // Delete manifest
  async deleteManifest(repositoryName, reference) {
    await api.delete(`/${repositoryName}/manifests/${reference}`)
  },

  // Get blob
  async getBlob(repositoryName, digest) {
    const response = await api.get(`/${repositoryName}/blobs/${digest}`, {
      responseType: 'blob'
    })
    return response.data
  },

  // Check if blob exists
  async checkBlob(repositoryName, digest) {
    try {
      await api.head(`/${repositoryName}/blobs/${digest}`)
      return true
    } catch {
      return false
    }
  }
}

// src/views/Home.vue
<template>
  <div>
    <div class="sm:flex sm:items-center">
      <div class="sm:flex-auto">
        <h1 class="text-2xl font-semibold text-gray-900">Container Repositories</h1>
        <p class="mt-2 text-sm text-gray-700">
          A list of all container image repositories in this registry.
        </p>
      </div>
      <div class="mt-4 sm:mt-0 sm:ml-16 sm:flex-none">
        <router-link
          to="/upload"
          class="inline-flex items-center justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 sm:w-auto"
        >
          Upload Image
        </router-link>
      </div>
    </div>

    <!-- Loading State -->
    <div v-if="loading" class="mt-8 text-center">
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
      <p class="mt-2 text-sm text-gray-500">Loading repositories...</p>
    </div>

    <!-- Error State -->
    <div v-else-if="error" class="mt-8 rounded-md bg-red-50 p-4">
      <div class="flex">
        <div class="flex-shrink-0">
          <XCircleIcon class="h-5 w-5 text-red-400" />
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-red-800">Error loading repositories</h3>
          <div class="mt-2 text-sm text-red-700">
            <p>{{ error }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div v-else-if="repositories.length === 0" class="mt-8 text-center">
      <div class="mx-auto h-12 w-12 text-gray-400">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
        </svg>
      </div>
      <h3 class="mt-2 text-sm font-medium text-gray-900">No repositories</h3>
      <p class="mt-1 text-sm text-gray-500">Get started by pushing your first container image.</p>
      <div class="mt-6">
        <router-link
          to="/upload"
          class="inline-flex items-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
        >
          <PlusIcon class="-ml-1 mr-2 h-5 w-5" />
          Upload Image
        </router-link>
      </div>
    </div>

    <!-- Repositories List -->
    <div v-else class="mt-8 flex flex-col">
      <div class="-my-2 -mx-4 overflow-x-auto sm:-mx-6 lg:-mx-8">
        <div class="inline-block min-w-full py-2 align-middle md:px-6 lg:px-8">
          <div class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg">
            <table class="min-w-full divide-y divide-gray-300">
              <thead class="bg-gray-50">
                <tr>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Repository
                  </th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Tags
                  </th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Created
                  </th>
                  <th scope="col" class="relative px-6 py-3">
                    <span class="sr-only">Actions</span>
                  </th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <tr v-for="repo in repositories" :key="repo.name" class="hover:bg-gray-50">
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                      <div class="flex-shrink-0 h-10 w-10">
                        <div class="h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center">
                          <span class="text-blue-600 font-medium text-sm">{{ repo.name.charAt(0).toUpperCase() }}</span>
                        </div>
                      </div>
                      <div class="ml-4">
                        <div class="text-sm font-medium text-gray-900">{{ repo.name }}</div>
                        <div class="text-sm text-gray-500">{{ repo.name }}</div>
                      </div>
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                      {{ repo.tagCount || 0 }} tags
                    </span>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    {{ formatDate(repo.createdAt) }}
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <router-link
                      :to="`/repository/${repo.name}`"
                      class="text-blue-600 hover:text-blue-900 mr-4"
                    >
                      View
                    </router-link>
                    <button
                      @click="deleteRepository(repo.name)"
                      class="text-red-600 hover:text-red-900"
                    >
                      Delete
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { onMounted } from 'vue'
import { XCircleIcon, PlusIcon } from '@heroicons/vue/24/outline'
import { useRegistryStore } from '../stores/registry'

const store = useRegistryStore()

const { repositories, loading, error } = store

onMounted(() => {
  store.fetchRepositories()
})

function formatDate(dateString) {
  if (!dateString) return 'Unknown'
  return new Date(dateString).toLocaleDateString()
}

async function deleteRepository(name) {
  if (confirm(`Are you sure you want to delete repository "${name}"?`)) {
    try {
      // This would need to be implemented in the backend
      console.log('Delete repository:', name)
    } catch (err) {
      alert('Failed to delete repository: ' + err.message)
    }
  }
}
</script>

// src/views/Repository.vue
<template>
  <div>
    <div class="md:flex md:items-center md:justify-between">
      <div class="flex-1 min-w-0">
        <nav class="flex" aria-label="Breadcrumb">
          <ol role="list" class="flex items-center space-x-4">
            <li>
              <div>
                <router-link to="/" class="text-gray-400 hover:text-gray-500">
                  <span class="sr-only">Home</span>
                  Repositories
                </router-link>
              </div>
            </li>
            <li>
              <div class="flex items-center">
                <svg class="flex-shrink-0 h-5 w-5 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                </svg>
                <span class="ml-4 text-sm font-medium text-gray-500">{{ name }}</span>
              </div>
            </li>
          </ol>
        </nav>
        <h2 class="mt-2 text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate">
          {{ name }}
        </h2>
      </div>
    </div>

    <!-- Loading State -->
    <div v-if="loading" class="mt-8 text-center">
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
      <p class="mt-2 text-sm text-gray-500">Loading repository details...</p>
    </div>

    <!-- Error State -->
    <div v-else-if="error" class="mt-8 rounded-md bg-red-50 p-4">
      <div class="flex">
        <div class="flex-shrink-0">
          <XCircleIcon class="h-5 w-5 text-red-400" />
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-red-800">Error loading repository</h3>
          <div class="mt-2 text-sm text-red-700">
            <p>{{ error }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Repository Details -->
    <div v-else class="mt-8">
      <!-- Stats -->
      <div class="grid grid-cols-1 gap-5 sm:grid-cols-3">
        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="p-5">
            <div class="flex items-center">
              <div class="flex-shrink-0">
                <TagIcon class="h-6 w-6 text-gray-400" />
              </div>
              <div class="ml-5 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">Total Tags</dt>
                  <dd class="text-lg font-medium text-gray-900">{{ tags.length }}</dd>
                </dl>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="p-5">
            <div class="flex items-center">
              <div class="flex-shrink-0">
                <ClockIcon class="h-6 w-6 text-gray-400" />
              </div>
              <div class="ml-5 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">Last Updated</dt>
                  <dd class="text-lg font-medium text-gray-900">{{ formatDate(lastUpdated) }}</dd>
                </dl>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="p-5">
            <div class="flex items-center">
              <div class="flex-shrink-0">
                <CubeIcon class="h-6 w-6 text-gray-400" />
              </div>
              <div class="ml-5 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">Repository</dt>
                  <dd class="text-lg font-medium text-gray-900">{{ name }}</dd>
                </dl>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tags Table -->
      <div class="mt-8">
        <div class="sm:flex sm:items-center">
          <div class="sm:flex-auto">
            <h3 class="text-lg leading-6 font-medium text-gray-900">Tags</h3>
            <p class="mt-2 text-sm text-gray-700">A list of all tags in this repository.</p>
          </div>
        </div>

        <div v-if="tags.length === 0" class="mt-8 text-center">
          <TagIcon class="mx-auto h-12 w-12 text-gray-400" />
          <h3 class="mt-2 text-sm font-medium text-gray-900">No tags</h3>
          <p class="mt-1 text-sm text-gray-500">This repository doesn't have any tags yet.</p>
        </div>

        <div v-else class="mt-8 flex flex-col">
          <div class="-my-2 -mx-4 overflow-x-auto sm:-mx-6 lg:-mx-8">
            <div class="inline-block min-w-full py-2 align-middle md:px-6 lg:px-8">
              <div class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg">
                <table class="min-w-full divide-y divide-gray-300">
                  <thead class="bg-gray-50">
                    <tr>
                      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Tag
                      </th>
                      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Digest
                      </th>
                      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Created
                      </th>
                      <th scope="col" class="relative px-6 py-3">
                        <span class="sr-only">Actions</span>
                      </th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-200">
                    <tr v-for="tag in tags" :key="tag" class="hover:bg-gray-50">
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                          <TagIcon class="h-5 w-5 text-gray-400 mr-3" />
                          <div class="text-sm font-medium text-gray-900">{{ tag }}</div>
                        </div>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900 font-mono">
                          {{ getTagDigest(tag) }}
                        </div>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        {{ formatDate(getTagCreatedDate(tag)) }}
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button
                          @click="viewManifest(tag)"
                          class="text-blue-600 hover:text-blue-900 mr-4"
                        >
                          View
                        </button>
                        <button
                          @click="deleteTag(tag)"
                          class="text-red-600 hover:text-red-900"
                        >
                          Delete
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Manifest Modal -->
      <div v-if="selectedManifest" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-10" @click="closeManifest">
        <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white" @click.stop>
          <div class="mt-3">
            <div class="flex items-center justify-between">
              <h3 class="text-lg font-medium text-gray-900">Manifest: {{ selectedTag }}</h3>
              <button @click="closeManifest" class="text-gray-400 hover:text-gray-600">
                <XMarkIcon class="h-6 w-6" />
              </button>
            </div>
            <div class="mt-4">
              <div class="bg-gray-50 rounded-lg p-4">
                <pre class="text-sm text-gray-800 whitespace-pre-wrap">{{ JSON.stringify(selectedManifest, null, 2) }}</pre>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { XCircleIcon, TagIcon, ClockIcon, CubeIcon, XMarkIcon } from '@heroicons/vue/24/outline'
import { useRegistryStore } from '../stores/registry'

const props = defineProps({
  name: {
    type: String,
    required: true
  }
})

const store = useRegistryStore()
const loading = ref(false)
const error = ref(null)
const tags = ref([])
const lastUpdated = ref(null)
const selectedManifest = ref(null)
const selectedTag = ref(null)
const manifests = ref({})

onMounted(async () => {
  await loadRepository()
})

async function loadRepository() {
  loading.value = true
  error.value = null
  try {
    const response = await store.getTags(props.name)
    tags.value = response.tags || []
    lastUpdated.value = new Date().toISOString()
  } catch (err) {
    error.value = err.message
  } finally {
    loading.value = false
  }
}

async function viewManifest(tag) {
  try {
    const manifest = await store.getManifest(props.name, tag)
    selectedManifest.value = manifest.content
    selectedTag.value = tag
    manifests.value[tag] = manifest
  } catch (err) {
    alert('Failed to load manifest: ' + err.message)
  }
}

function closeManifest() {
  selectedManifest.value = null
  selectedTag.value = null
}

async function deleteTag(tag) {
  if (confirm(`Are you sure you want to delete tag "${tag}"?`)) {
    try {
      await store.deleteManifest(props.name, tag)
      await loadRepository()
    } catch (err) {
      alert('Failed to delete tag: ' + err.message)
    }
  }
}

function formatDate(dateString) {
  if (!dateString) return 'Unknown'
  return new Date(dateString).toLocaleDateString()
}

function getTagDigest(tag) {
  const manifest = manifests.value[tag]
  return manifest?.digest?.substring(0, 16) + '...' || 'Loading...'
}

function getTagCreatedDate(tag) {
  return new Date().toISOString() // This would come from the manifest in a real implementation
}
</script>

// src/views/Upload.vue
<template>
  <div>
    <div class="md:flex md:items-center md:justify-between">
      <div class="flex-1 min-w-0">
        <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate">
          Upload Container Image
        </h2>
        <p class="mt-1 text-sm text-gray-500">
          Upload container images to the registry using Docker commands.
        </p>
      </div>
    </div>

    <div class="mt-8 max-w-3xl">
      <!-- Upload Instructions -->
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
        <h3 class="text-lg font-medium text-blue-900 mb-4">How to Push Images</h3>
        <div class="space-y-4">
          <div>
            <h4 class="font-medium text-blue-800">1. Tag your image</h4>
            <div class="mt-2 bg-blue-100 rounded p-3">
              <code class="text-sm text-blue-900">
                docker tag your-image:latest {{ registryUrl }}/repository-name:tag
              </code>
            </div>
          </div>

          <div>
            <h4 class="font-medium text-blue-800">2. Push to registry</h4>
            <div class="mt-2 bg-blue-100 rounded p-3">
              <code class="text-sm text-blue-900">
                docker push {{ registryUrl }}/repository-name:tag
              </code>
            </div>
          </div>
        </div>
      </div>

      <!-- Registry Configuration -->
      <div class="mt-8 bg-white shadow rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
          <h3 class="text-lg font-medium text-gray-900">Registry Configuration</h3>
        </div>
        <div class="px-6 py-4 space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700">Registry URL</label>
            <div class="mt-1 flex rounded-md shadow-sm">
              <input
                v-model="registryUrl"
                type="text"
                class="flex-1 min-w-0 block w-full px-3 py-2 rounded-md border-gray-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                readonly
              />
              <button
                @click="copyToClipboard(registryUrl)"
                class="inline-flex items-center px-3 py-2 border border-l-0 border-gray-300 rounded-r-md bg-gray-50 text-gray-500 text-sm hover:bg-gray-100"
              >
                <ClipboardIcon class="h-4 w-4" />
              </button>
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700">Status</label>
            <div class="mt-1">
              <span
                :class="registryStatus ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'"
                class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
              >
                <span
                  :class="registryStatus ? 'bg-green-400' : 'bg-red-400'"
                  class="w-1.5 h-1.5 rounded-full mr-1.5"
                ></span>
                {{ registryStatus ? 'Online' : 'Offline' }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Example Commands -->
      <div class="mt-8 bg-white shadow rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
          <h3 class="text-lg font-medium text-gray-900">Example Commands</h3>
        </div>
        <div class="px-6 py-4">
          <div class="space-y-6">
            <div>
              <h4 class="font-medium text-gray-900 mb-2">Push a simple image</h4>
              <div class="bg-gray-900 rounded-lg p-4 overflow-x-auto">
                <div class="space-y-2 text-sm">
                  <div class="text-gray-300"># Tag your local image</div>
                  <div class="text-green-400">docker tag alpine:latest {{ registryUrl }}/alpine:latest</div>
                  <div class="text-gray-300"># Push to registry</div>
                  <div class="text-green-400">docker push {{ registryUrl }}/alpine:latest</div>
                </div>
              </div>
            </div>

            <div>
              <h4 class="font-medium text-gray-900 mb-2">Build and push from Dockerfile</h4>
              <div class="bg-gray-900 rounded-lg p-4 overflow-x-auto">
                <div class="space-y-2 text-sm">
                  <div class="text-gray-300"># Build image with registry tag</div>
                  <div class="text-green-400">docker build -t {{ registryUrl }}/myapp:v1.0 .</div>
                  <div class="text-gray-300"># Push to registry</div>
                  <div class="text-green-400">docker push {{ registryUrl }}/myapp:v1.0</div>
                </div>
              </div>
            </div>

            <div>
              <h4 class="font-medium text-gray-900 mb-2">Pull from registry</h4>
              <div class="bg-gray-900 rounded-lg p-4 overflow-x-auto">
                <div class="space-y-2 text-sm">
                  <div class="text-gray-300"># Pull image from registry</div>
                  <div class="text-green-400">docker pull {{ registryUrl }}/myapp:v1.0</div>
                  <div class="text-gray-300"># Run the image</div>
                  <div class="text-green-400">docker run {{ registryUrl }}/myapp:v1.0</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Docker Configuration -->
      <div class="mt-8 bg-yellow-50 border border-yellow-200 rounded-lg p-6">
        <h3 class="text-lg font-medium text-yellow-900 mb-4">
          <ExclamationTriangleIcon class="h-5 w-5 inline mr-2" />
          Docker Configuration
        </h3>
        <p class="text-yellow-800 mb-4">
          If your registry is running on HTTP (not HTTPS), you need to configure Docker to allow insecure registries:
        </p>
        <div class="bg-yellow-100 rounded p-3">
          <div class="text-sm text-yellow-900 space-y-2">
            <div>1. Edit or create <code>/etc/docker/daemon.json</code></div>
            <div>2. Add the following configuration:</div>
            <pre class="mt-2 bg-white p-2 rounded text-xs overflow-x-auto">{
  "insecure-registries": ["{{ registryUrl }}"]
}</pre>
            <div>3. Restart Docker daemon: <code>sudo systemctl restart docker</code></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { ClipboardIcon, ExclamationTriangleIcon } from '@heroicons/vue/24/outline'
import registryAPI from '../api/registry'

const registryUrl = ref('localhost:8080')
const registryStatus = ref(false)

onMounted(async () => {
  await checkRegistryStatus()
})

async function checkRegistryStatus() {
  try {
    registryStatus.value = await registryAPI.checkVersion()
  } catch {
    registryStatus.value = false
  }
}

async function copyToClipboard(text) {
  try {
    await navigator.clipboard.writeText(text)
    // You could add a toast notification here
  } catch (err) {
    // Fallback for older browsers
    const textArea = document.createElement('textarea')
    textArea.value = text
    document.body.appendChild(textArea)
    textArea.select()
    document.execCommand('copy')
    document.body.removeChild(textArea)
  }
}
</script>

// index.html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OCI Registry</title>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>

// Additional backend endpoint for repository listing
// Add to ManifestResource.java

@GET
@Path("/repositories")
@Produces(MediaType.APPLICATION_JSON)
public Response listRepositories() {
    List<Repository> repos = Repository.listAll();

    List<Map<String, Object>> repoList = repos.stream()
        .map(repo -> {
            Map<String, Object> repoInfo = new HashMap<>();
            repoInfo.put("name", repo.name);
            repoInfo.put("createdAt", repo.createdAt);
            repoInfo.put("updatedAt", repo.updatedAt);

            // Count tags for this repository
            long tagCount = Manifest.count("repository = ?1 and tag is not null", repo);
            repoInfo.put("tagCount", tagCount);

            return repoInfo;
        })
        .collect(Collectors.toList());

    return Response.ok(repoList).build();
}

// Database schema (for PostgreSQL)
-- Create database
CREATE DATABASE oci_registry;

-- Use the database
\c oci_registry;

-- Create repositories table
CREATE TABLE repositories (
    id BIGSERIAL PRIMARY KEY,
    name VARCHAR(255) UNIQUE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Create manifests table
CREATE TABLE manifests (
    id BIGSERIAL PRIMARY KEY,
    repository_id BIGINT NOT NULL REFERENCES repositories(id) ON DELETE CASCADE,
    digest VARCHAR(255) NOT NULL,
    media_type VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    content_length BIGINT,
    tag VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(digest)
);

-- Create blobs table
CREATE TABLE blobs (
    id BIGSERIAL PRIMARY KEY,
    digest VARCHAR(255) UNIQUE NOT NULL,
    content_length BIGINT,
    media_type VARCHAR(255),
    file_path VARCHAR(500),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Create indexes for better performance
CREATE INDEX idx_manifests_repository_tag ON manifests(repository_id, tag);
CREATE INDEX idx_manifests_digest ON manifests(digest);
CREATE INDEX idx_blobs_digest ON blobs(digest);

-- Docker Compose file for easy deployment
version: '3.8'
services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: oci_registry
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  registry-backend:
    build: .
    ports:
      - "8080:8080"
    environment:
      DB_URL: jdbc:postgresql://postgres:5432/oci_registry
      DB_USERNAME: postgres
      DB_PASSWORD: postgres
      OCI_STORAGE_ROOT: /app/storage
    volumes:
      - registry_storage:/app/storage
    depends_on:
      - postgres

  registry-frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "3000:80"
    depends_on:
      - registry-backend

volumes:
  postgres_data:
  registry_storage:

# Frontend Dockerfile
FROM node:18-alpine as build
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80

# nginx.conf for frontend
server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    # Handle SPA routing
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Proxy API requests to backend
    location /v2/ {
        proxy_pass http://registry-backend:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Handle large uploads
        client_max_body_size 1000M;
    }
}

# Backend Dockerfile
FROM quarkus/ubi-quarkus-graalvm:22.3-java17 AS build
USER quarkus
WORKDIR /code
COPY --chown=quarkus:quarkus mvnw /code/mvnw
COPY --chown=quarkus:quarkus .mvn /code/.mvn
COPY --chown=quarkus:quarkus pom.xml /code/
COPY --chown=quarkus:quarkus src /code/src
RUN ./mvnw clean package -Pnative

FROM quarkus/ubi-quarkus-micro:latest
WORKDIR /work/

COPY --from=build --chown=185 /code/target/*-runner /work/application
RUN mkdir -p /work/storage && chown 185:185 /work/storage

EXPOSE 8080
USER 185
ENV OCI_STORAGE_ROOT=/work/storage

ENTRYPOINT ["./application", "-Dquarkus.http.host=0.0.0.0"]

# README.md
# OCI Distribution Spec Registry

A complete implementation of the OCI Distribution Specification using Quarkus (backend) and Vue 3 (frontend).

## Features

- ✅ Full OCI Distribution Spec v1.0 compliance
- ✅ Manifest API (GET, PUT, DELETE)
- ✅ Blob API (GET, POST, PUT, DELETE)
- ✅ Tag listing API
- ✅ Repository management
- ✅ Web UI for registry management
- ✅ Docker/Podman compatible
- ✅ PostgreSQL storage for metadata
- ✅ File system storage for blobs

## Quick Start

1. **Start with Docker Compose:**
   ```bash
   docker-compose up -d
   ```

2. **Access the web interface:**
   Open http://localhost:3000

3. **Configure Docker for insecure registry:**
   ```json
   {
     "insecure-registries": ["localhost:8080"]
   }
   ```

4. **Push an image:**
   ```bash
   docker tag alpine:latest localhost:8080/alpine:latest
   docker push localhost:8080/alpine:latest
   ```

## API Endpoints

- `GET /v2/` - Check API version
- `GET /v2/{name}/manifests/{reference}` - Get manifest
- `PUT /v2/{name}/manifests/{reference}` - Put manifest
- `DELETE /v2/{name}/manifests/{reference}` - Delete manifest
- `GET /v2/{name}/blobs/{digest}` - Get blob
- `POST /v2/{name}/blobs/uploads/` - Start blob upload
- `PUT /v2/{name}/blobs/uploads/{uuid}` - Complete blob upload
- `GET /v2/{name}/tags/list` - List tags

## Development

**Backend (Quarkus):**
```bash
./mvnw quarkus:dev
```

**Frontend (Vue 3):**
```bash
npm install
npm run dev
```

## Storage

- **Metadata:** PostgreSQL database
- **Blobs:** File system storage (configurable via `OCI_STORAGE_ROOT`)

This implementation provides a fully functional OCI-compliant container registry with modern web interface.