import{r as b,O as z,c as p,o as i,a as s,d as l,w as t,b as E,ab as K,j as Q,u as T,ac as X,s as n,l as Y,S as Z,T as ee,U as le,t as u,L as te,g as W,p as ae,x as se,I as oe,F as ne,H as de,i as re,ad as ue,J as ie,K as A,ae as pe,af as ce,C as y,aa as fe}from"./index-CarGvsjG.js";/* empty css                     */import{_ as me}from"./el-input-BtvPs5Ei.js";/* empty css                   *//* empty css                        *//* empty css                    *//* empty css                *//* empty css                 */const _e={class:"upload-container"},ve={class:"card-header"},ge={class:"upload-section"},be={class:"upload-actions"},ye={key:0,class:"upload-result"},he={key:0,class:"batch-summary"},we={key:1},Ue={key:0,class:"file-results"},ke={key:0},Fe={key:1},Ie={key:1,class:"result-details"},Ee={key:0,class:"manifest-list"},ze={class:"upload-content"},Te={class:"step"},Ve={class:"step-content"},Ce={class:"step"},Se={class:"step-content"},$e={class:"step"},De={class:"step-content"},Re={__name:"Upload",setup(xe){const H=b(),v=b([]),V=b(!1),o=b(null),h=b("my-app"),w=b("latest"),C=z(()=>{const{hostname:d,port:e}=window.location;return e&&e!=="80"?`${d}:${e}`:d}),S=z(()=>`docker tag ${h.value}:${w.value} ${C.value}/${h.value}:${w.value}`),$=z(()=>`docker push ${C.value}/${h.value}:${w.value}`),D=z(()=>`docker login ${C.value}`),j=d=>d.name.endsWith(".tar")||d.name.endsWith(".tar.gz")||d.name.endsWith(".tgz")||d.name.endsWith(".tar.zst")||d.name.endsWith(".zip")?!0:(y.error("Only .tar, .tar.gz, .tgz, .tar.zst, and .zip files are supported"),!1),q=()=>{o.value=null},M=async()=>{if(v.value.length===0){y.warning("Please select at least one file");return}V.value=!0,o.value=null;try{const d=new FormData;v.value.forEach(U=>{d.append("files",U.raw)});const e=fe(),c=e.getAuthHeader(),m={};c&&(m.Authorization=c);const g=await fetch("/funeral_addition/write/upload/dockertar/batch",{method:"POST",headers:m,body:d,credentials:"include"});if(g.status===401)throw e.logout(),new Error("Authentication required. Please log in.");if(!g.ok)throw new Error(`Upload failed: ${g.statusText}`);const r=await g.json();if(r.totalFiles){if(o.value={success:r.failedUploads===0,repositories:r.repositories||[],manifests:r.manifests||[],blobs:r.blobs||[],batchInfo:{totalFiles:r.totalFiles,successfulUploads:r.successfulUploads,failedUploads:r.failedUploads,results:r.results}},r.failedUploads>0){const U=r.results.filter(f=>!f.success);console.error("Failed files:",U)}}else o.value={success:!0,...r};v.value=[],y.success(`Successfully uploaded ${r.successfulUploads||1} files!`)}catch(d){console.error("Upload error:",d),o.value={success:!1,error:d.message},y.error(d.message||"Upload failed")}finally{V.value=!1}},R=async d=>{try{await navigator.clipboard.writeText(d),y.success("Copied to clipboard")}catch{y.error("Failed to copy to clipboard")}};return(d,e)=>{const c=te,m=Q,g=K,r=Y,U=Z,f=le,B=ee,_=se,k=oe,N=ae,x=re,G=ue,F=ie,L=ce,J=pe;return i(),p("div",_e,[e[27]||(e[27]=s("div",{class:"page-header"},[s("h1",null,"Upload Image")],-1)),l(x,{class:"upload-tar-card"},{header:t(()=>[s("div",ve,[e[10]||(e[10]=s("span",null,"ðŸ“¦ Upload Docker Tar File",-1)),l(c,{type:"success"},{default:t(()=>[...e[9]||(e[9]=[n("New Feature",-1)])]),_:1})])]),default:t(()=>[s("div",ge,[l(g,{ref_key:"uploadRef",ref:H,"file-list":v.value,"onUpdate:fileList":e[0]||(e[0]=a=>v.value=a),class:"tar-uploader",drag:"",action:"#",accept:".tar,.tar.gz,.tgz,.tar.zst,.zip","auto-upload":!1,"before-upload":j,"on-remove":q,multiple:""},{tip:t(()=>[...e[11]||(e[11]=[s("div",{class:"el-upload__tip"},[n(" Supports: .tar, .tar.gz, .tgz, .tar.zst, and .zip (containing tar files)"),s("br"),n(" Use "),s("code",null,"docker save image:tag -o image.tar"),n(" to create tar file ")],-1)])]),default:t(()=>[l(m,{class:"el-icon--upload"},{default:t(()=>[l(T(X))]),_:1}),e[12]||(e[12]=s("div",{class:"el-upload__text"},[n(" Drop Docker tar file here or "),s("em",null,"click to upload")],-1))]),_:1},8,["file-list"]),s("div",be,[l(r,{type:"primary",loading:V.value,disabled:v.value.length===0,onClick:M},{default:t(()=>[...e[13]||(e[13]=[n(" Upload and Analyze ",-1)])]),_:1},8,["loading","disabled"])]),o.value?(i(),p("div",ye,[l(U,{title:o.value.success?"Upload successful!":"Upload failed",type:o.value.success?"success":"error",closable:!1,"show-icon":""},null,8,["title","type"]),o.value.batchInfo?(i(),p("div",he,[e[15]||(e[15]=s("h4",null,"ðŸ“Š Batch Upload Summary:",-1)),l(B,{column:3,border:""},{default:t(()=>[l(f,{label:"Total Files"},{default:t(()=>[n(u(o.value.batchInfo.totalFiles),1)]),_:1}),l(f,{label:"Successful"},{default:t(()=>[l(c,{type:"success"},{default:t(()=>[n(u(o.value.batchInfo.successfulUploads),1)]),_:1})]),_:1}),l(f,{label:"Failed"},{default:t(()=>[o.value.batchInfo.failedUploads>0?(i(),W(c,{key:0,type:"danger"},{default:t(()=>[n(u(o.value.batchInfo.failedUploads),1)]),_:1})):(i(),p("span",we,"0"))]),_:1})]),_:1}),o.value.batchInfo.results&&o.value.batchInfo.results.length>0?(i(),p("div",Ue,[e[14]||(e[14]=s("h4",null,"ðŸ“ Individual File Results:",-1)),l(N,{data:o.value.batchInfo.results,border:"",stripe:"",style:{width:"100%"}},{default:t(()=>[l(_,{label:"#",width:"60"},{default:t(a=>[n(u(a.row.fileIndex),1)]),_:1}),l(_,{label:"Status",width:"100"},{default:t(a=>[l(c,{type:a.row.success?"success":"danger"},{default:t(()=>[n(u(a.row.success?"Success":"Failed"),1)]),_:2},1032,["type"])]),_:1}),l(_,{label:"Details"},{default:t(a=>[a.row.success&&a.row.uploadResponse?(i(),p("div",ke,[l(k,{type:"success"},{default:t(()=>{var I,O,P;return[n(u(((I=a.row.uploadResponse.repositories)==null?void 0:I.length)||0)+" repositories, "+u(((O=a.row.uploadResponse.manifests)==null?void 0:O.length)||0)+" manifests, "+u(((P=a.row.uploadResponse.blobs)==null?void 0:P.length)||0)+" blobs ",1)]}),_:2},1024)])):(i(),p("div",Fe,[l(k,{type:"danger"},{default:t(()=>[n(u(a.row.error),1)]),_:2},1024)]))]),_:1})]),_:1},8,["data"])])):E("",!0)])):E("",!0),o.value.repositories?(i(),p("div",Ie,[e[17]||(e[17]=s("h4",null,"ðŸ“Š Analysis Results:",-1)),l(B,{column:1,border:""},{default:t(()=>[l(f,{label:"Repositories Found"},{default:t(()=>[(i(!0),p(ne,null,de(o.value.repositories,a=>(i(),W(c,{key:a,type:"info",class:"result-tag"},{default:t(()=>[n(u(a),1)]),_:2},1024))),128))]),_:1}),l(f,{label:"Manifests"},{default:t(()=>{var a;return[n(u(((a=o.value.manifests)==null?void 0:a.length)||0),1)]}),_:1}),l(f,{label:"Blobs"},{default:t(()=>{var a;return[n(u(((a=o.value.blobs)==null?void 0:a.length)||0),1)]}),_:1})]),_:1}),o.value.manifests?(i(),p("div",Ee,[e[16]||(e[16]=s("h4",null,"ðŸ“‹ Image Tags Found:",-1)),l(N,{data:o.value.manifests,border:"",stripe:"",style:{width:"100%"}},{default:t(()=>[l(_,{prop:"repository",label:"Repository"}),l(_,{prop:"tag",label:"Tag"}),l(_,{prop:"configDigest",label:"Config Digest","show-overflow-tooltip":""}),l(_,{label:"Layers",width:"100"},{default:t(a=>[l(c,{size:"small"},{default:t(()=>{var I;return[n(u(((I=a.row.layerDigests)==null?void 0:I.length)||0),1)]}),_:2},1024)]),_:1})]),_:1},8,["data"])])):E("",!0)])):E("",!0)])):E("",!0)])]),_:1}),l(G,{"content-position":"center"},{default:t(()=>[...e[18]||(e[18]=[n("OR",-1)])]),_:1}),l(x,{class:"upload-card"},{header:t(()=>[...e[19]||(e[19]=[s("div",{class:"card-header"},[s("span",null,"Docker Push Guide")],-1)])]),default:t(()=>[s("div",ze,[s("div",Te,[e[21]||(e[21]=s("h3",null,"Step 1: Tag your image",-1)),s("div",Ve,[l(k,{type:"info"},{default:t(()=>[...e[20]||(e[20]=[n("Use the following command to tag your Docker image:",-1)])]),_:1}),l(F,{modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=a=>S.value=a),readonly:"",class:"command-input"},{append:t(()=>[l(r,{onClick:e[1]||(e[1]=a=>R(S.value))},{default:t(()=>[l(m,null,{default:t(()=>[l(T(A))]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),s("div",Ce,[e[23]||(e[23]=s("h3",null,"Step 2: Push to registry",-1)),s("div",Se,[l(k,{type:"info"},{default:t(()=>[...e[22]||(e[22]=[n("Then push the tagged image to this registry:",-1)])]),_:1}),l(F,{modelValue:$.value,"onUpdate:modelValue":e[4]||(e[4]=a=>$.value=a),readonly:"",class:"command-input"},{append:t(()=>[l(r,{onClick:e[3]||(e[3]=a=>R($.value))},{default:t(()=>[l(m,null,{default:t(()=>[l(T(A))]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),s("div",$e,[e[25]||(e[25]=s("h3",null,"Step 3: Authenticate (Optional)",-1)),s("div",De,[l(k,{type:"info"},{default:t(()=>[...e[24]||(e[24]=[n("If authentication is required, login first:",-1)])]),_:1}),l(F,{modelValue:D.value,"onUpdate:modelValue":e[6]||(e[6]=a=>D.value=a),readonly:"",class:"command-input"},{append:t(()=>[l(r,{onClick:e[5]||(e[5]=a=>R(D.value))},{default:t(()=>[l(m,null,{default:t(()=>[l(T(A))]),_:1})]),_:1})]),_:1},8,["modelValue"])])])])]),_:1}),l(x,{class:"config-card"},{header:t(()=>[...e[26]||(e[26]=[s("div",{class:"card-header"},[s("span",null,"Configuration")],-1)])]),default:t(()=>[l(J,{"label-width":"120px"},{default:t(()=>[l(L,{label:"Repository Name"},{default:t(()=>[l(F,{modelValue:h.value,"onUpdate:modelValue":e[7]||(e[7]=a=>h.value=a),placeholder:"my-app"},null,8,["modelValue"])]),_:1}),l(L,{label:"Image Tag"},{default:t(()=>[l(F,{modelValue:w.value,"onUpdate:modelValue":e[8]||(e[8]=a=>w.value=a),placeholder:"latest"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])}}},je=me(Re,[["__scopeId","data-v-c071b399"]]);export{je as default};
