import{aa as N,r as S,ag as O,M as L,c as V,o as I,a as r,d as t,g as J,b as K,w as l,ae as Q,af as G,J as W,ah as X,j as Y,u as x,ai as Z,ad as ee,s as u,Q as te,aj as le,l as re,ak as ae,a6 as oe,i as se,R as ne,S as ie,t as b,I as ue,K as de,al as pe,am as ce,an as me,ao as ge,ap as fe,C as w,z as _e}from"./index-DIS63wu8.js";/* empty css                */import{_ as ye}from"./el-input-BtvPs5Ei.js";/* empty css                     *//* empty css                  *//* empty css                 *//* empty css                   */const ve={class:"mirror-container"},be={class:"card-header"},we={class:"mirror-actions"},Te={key:0,class:"result-success"},Ee={class:"result-details"},Re={class:"result-actions"},Ie={key:1,class:"result-error"},Ve={class:"help-content"},xe={__name:"Mirror",setup(Ce){const F=_e(),C=N(),f=S(!1),o=S(null),a=O({sourceImage:"",targetRepository:"",targetTag:"",username:"",password:"",insecure:!1}),D={sourceImage:[{required:!0,message:"Please enter source image reference",trigger:"blur"}]},U=async()=>{var i,e,p,d,m,c;if(!a.sourceImage){w.error("Please enter a source image");return}f.value=!0,o.value=null;try{const s=new URLSearchParams;s.append("sourceImage",a.sourceImage.trim()),(i=a.targetRepository)!=null&&i.trim()&&s.append("targetRepository",a.targetRepository.trim()),(e=a.targetTag)!=null&&e.trim()&&s.append("targetTag",a.targetTag.trim()),(p=a.username)!=null&&p.trim()&&s.append("username",a.username.trim()),(d=a.password)!=null&&d.trim()&&s.append("password",a.password.trim()),a.insecure&&s.append("insecure","true");const T=C.getAuthHeader(),_={"Content-Type":"application/x-www-form-urlencoded"};T&&(_.Authorization=T);const g=await fetch("/funeral_addition/mirror/pull",{method:"POST",headers:_,body:s,credentials:"include"});if(g.status===401)throw C.logout(),new Error("Authentication required. Please log in.");if(!g.ok){const v=((c=(m=(await g.json()).errors)==null?void 0:m[0])==null?void 0:c.message)||`Mirror failed: ${g.statusText}`;throw new Error(v)}const E=await g.json();o.value={success:!0,...E},w.success(`Successfully mirrored ${E.sourceImage}!`)}catch(s){console.error("Mirror error:",s),o.value={success:!1,error:s.message||"Mirror failed"},w.error(s.message||"Mirror failed")}finally{f.value=!1}},$=()=>{a.sourceImage="",a.targetRepository="",a.targetTag="",a.username="",a.password="",a.insecure=!1,o.value=null},A=()=>{var i;(i=o.value)!=null&&i.targetRepository&&F.push(`/repository/${o.value.targetRepository}`)},k=L(()=>{var d,m;if(!((d=o.value)!=null&&d.targetRepository)||!((m=o.value)!=null&&m.targetTag))return"";const{hostname:i,port:e}=window.location;return`docker pull ${e&&e!=="80"?`${i}:${e}`:i}/${o.value.targetRepository}:${o.value.targetTag}`}),q=async()=>{if(k.value)try{await navigator.clipboard.writeText(k.value),w.success("Pull command copied to clipboard")}catch{w.error("Failed to copy to clipboard")}};return(i,e)=>{const p=oe,d=Y,m=X,c=W,s=G,T=ee,_=te,g=le,E=Q,y=re,v=se,R=ie,B=ue,H=ne,h=pe,M=me,P=fe,j=ge,z=ce;return I(),V("div",ve,[e[22]||(e[22]=r("div",{class:"page-header"},[r("h1",null,"ðŸ—ï¸ Mirror Image"),r("p",{class:"subtitle"},"Pull images from external registries directly to this registry")],-1)),t(v,{class:"mirror-card"},{header:l(()=>[r("div",be,[e[7]||(e[7]=r("span",null,"ðŸ“¦ Pull from External Registry",-1)),t(p,{type:"success"},{default:l(()=>[...e[6]||(e[6]=[u("New Feature",-1)])]),_:1})])]),default:l(()=>[t(E,{ref:"mirrorForm",model:a,rules:D,"label-width":"140px",class:"mirror-form"},{default:l(()=>[t(s,{label:"Source Image",prop:"sourceImage"},{default:l(()=>[t(c,{modelValue:a.sourceImage,"onUpdate:modelValue":e[0]||(e[0]=n=>a.sourceImage=n),placeholder:"docker.io/library/nginx:latest",clearable:""},{append:l(()=>[t(m,{content:"Examples: nginx:latest, docker.io/library/mysql:8.0, gcr.io/project/image:tag"},{default:l(()=>[t(d,null,{default:l(()=>[t(x(Z))]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[8]||(e[8]=r("div",{class:"form-tip"},"Full image reference including registry, repository, and tag",-1))]),_:1}),t(s,{label:"Target Repository",prop:"targetRepository"},{default:l(()=>[t(c,{modelValue:a.targetRepository,"onUpdate:modelValue":e[1]||(e[1]=n=>a.targetRepository=n),placeholder:"nginx",clearable:""},null,8,["modelValue"]),e[9]||(e[9]=r("div",{class:"form-tip"},"Repository name in this registry (defaults to source repo name)",-1))]),_:1}),t(s,{label:"Target Tag",prop:"targetTag"},{default:l(()=>[t(c,{modelValue:a.targetTag,"onUpdate:modelValue":e[2]||(e[2]=n=>a.targetTag=n),placeholder:"latest",clearable:""},null,8,["modelValue"]),e[10]||(e[10]=r("div",{class:"form-tip"},"Tag for the mirrored image (defaults to source tag)",-1))]),_:1}),t(T,{"content-position":"left"},{default:l(()=>[...e[11]||(e[11]=[u("Authentication (Optional)",-1)])]),_:1}),t(_,{title:"Leave empty for public images. For private images, provide registry credentials.",type:"info",closable:!1,"show-icon":"",class:"auth-alert"}),t(s,{label:"Username"},{default:l(()=>[t(c,{modelValue:a.username,"onUpdate:modelValue":e[3]||(e[3]=n=>a.username=n),placeholder:"registry username",clearable:""},null,8,["modelValue"])]),_:1}),t(s,{label:"Password"},{default:l(()=>[t(c,{modelValue:a.password,"onUpdate:modelValue":e[4]||(e[4]=n=>a.password=n),type:"password",placeholder:"registry password","show-password":"",clearable:""},null,8,["modelValue"])]),_:1}),t(s,{label:"Insecure"},{default:l(()=>[t(g,{modelValue:a.insecure,"onUpdate:modelValue":e[5]||(e[5]=n=>a.insecure=n),"active-text":"Allow insecure HTTPS"},null,8,["modelValue"]),e[12]||(e[12]=r("div",{class:"form-tip"},"Only enable for self-signed certificates",-1))]),_:1})]),_:1},8,["model"]),r("div",we,[t(y,{type:"primary",size:"large",loading:f.value,disabled:!a.sourceImage||f.value,onClick:U},{default:l(()=>[t(d,null,{default:l(()=>[t(x(ae))]),_:1}),e[13]||(e[13]=u(" Start Mirroring ",-1))]),_:1},8,["loading","disabled"]),t(y,{onClick:$,disabled:f.value},{default:l(()=>[...e[14]||(e[14]=[u(" Reset ",-1)])]),_:1},8,["disabled"])])]),_:1}),o.value?(I(),J(v,{key:0,class:"result-card"},{header:l(()=>[...e[15]||(e[15]=[r("div",{class:"card-header"},[r("span",null,"ðŸ“Š Mirror Result")],-1)])]),default:l(()=>[o.value.success?(I(),V("div",Te,[t(h,{icon:"success",title:"Mirror Successful"},{subTitle:l(()=>[r("div",Ee,[t(H,{column:1,border:""},{default:l(()=>[t(R,{label:"Source Image"},{default:l(()=>[t(p,{type:"info"},{default:l(()=>[u(b(o.value.sourceImage),1)]),_:1})]),_:1}),t(R,{label:"Target"},{default:l(()=>[t(p,{type:"success"},{default:l(()=>[u(b(o.value.targetRepository)+":"+b(o.value.targetTag),1)]),_:1})]),_:1}),t(R,{label:"Manifest Digest"},{default:l(()=>[t(B,{tag:"code",size:"small"},{default:l(()=>[u(b(o.value.manifestDigest),1)]),_:1})]),_:1}),t(R,{label:"Blobs Pulled"},{default:l(()=>[t(p,{type:"info"},{default:l(()=>[u(b(o.value.blobsCount),1)]),_:1})]),_:1})]),_:1}),r("div",Re,[t(y,{type:"primary",onClick:A},{default:l(()=>[...e[16]||(e[16]=[u(" View Repository ",-1)])]),_:1}),t(y,{onClick:q},{default:l(()=>[t(d,null,{default:l(()=>[t(x(de))]),_:1}),e[17]||(e[17]=u(" Copy Pull Command ",-1))]),_:1})])])]),_:1})])):(I(),V("div",Ie,[t(h,{icon:"error",title:"Mirror Failed"},{subTitle:l(()=>[t(_,{title:o.value.error,type:"error",closable:!1,"show-icon":""},null,8,["title"])]),_:1})]))]),_:1})):K("",!0),t(v,{class:"help-card"},{header:l(()=>[...e[18]||(e[18]=[r("div",{class:"card-header"},[r("span",null,"ðŸ’¡ Help & Examples")],-1)])]),default:l(()=>[t(z,null,{default:l(()=>[t(M,{title:"ðŸ“– How it works",name:"1"},{default:l(()=>[...e[19]||(e[19]=[r("div",{class:"help-content"},[r("p",null,"1. Enter the source image reference from any OCI-compliant registry"),r("p",null,"2. Optional: Customize the target repository name and tag"),r("p",null,"3. For private images, provide registry credentials"),r("p",null,"4. The service will pull the image and all its layers automatically")],-1)])]),_:1}),t(M,{title:"ðŸ“ Example References",name:"2"},{default:l(()=>[r("div",Ve,[t(j,{gutter:20},{default:l(()=>[t(P,{span:12},{default:l(()=>[...e[20]||(e[20]=[r("h4",null,"Docker Hub (Public)",-1),r("ul",null,[r("li",null,[r("code",null,"nginx:latest")]),r("li",null,[r("code",null,"mysql:8.0")]),r("li",null,[r("code",null,"ubuntu:20.04")])],-1)])]),_:1}),t(P,{span:12},{default:l(()=>[...e[21]||(e[21]=[r("h4",null,"Full References",-1),r("ul",null,[r("li",null,[r("code",null,"docker.io/library/alpine:3.18")]),r("li",null,[r("code",null,"gcr.io/google-containers/pause:3.2")]),r("li",null,[r("code",null,"quay.io/prometheus/prometheus:latest")])],-1)])]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1})])}}},Ue=ye(xe,[["__scopeId","data-v-ab955205"]]);export{Ue as default};
