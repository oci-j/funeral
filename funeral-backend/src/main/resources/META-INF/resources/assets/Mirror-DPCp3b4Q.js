import{aa as L,r as U,ag as J,M as K,c as h,o as I,a as o,d as t,g as Q,b as W,w as l,ae as G,af as X,J as Y,ah as Z,j as ee,u as x,ai as te,aj as le,ak as oe,ad as re,s as d,Q as ae,al as se,l as ne,am as ie,a6 as ue,i as de,R as pe,S as ce,t as v,I as me,K as ge,an as fe,ao as _e,ap as ye,aq as ve,ar as be,C as b,z as we}from"./index-Bs5kgkS5.js";/* empty css                */import{_ as Te}from"./el-input-BtvPs5Ei.js";/* empty css                     *//* empty css                  *//* empty css                 *//* empty css                   */const Ee={class:"mirror-container"},Re={class:"card-header"},Ie={class:"mirror-actions"},Ve={key:0,class:"result-success"},he={class:"result-details"},xe={class:"result-actions"},ke={key:1,class:"result-error"},Ce={class:"help-content"},Pe={__name:"Mirror",setup(Se){const D=we(),k=L(),y=U(!1),a=U(null),r=J({sourceImage:"",targetRepository:"",targetTag:"",protocol:"https",username:"",password:"",insecure:!1}),H={sourceImage:[{required:!0,message:"Please enter source image reference",trigger:"blur"}]},$=async()=>{var u,e,c,p,f,m;if(!r.sourceImage){b.error("Please enter a source image");return}y.value=!0,a.value=null;try{let s=r.sourceImage.trim();s.startsWith("docker pull ")&&(s=s.substring(12).trim());const i=new URLSearchParams;i.append("sourceImage",s),(u=r.targetRepository)!=null&&u.trim()&&i.append("targetRepository",r.targetRepository.trim()),(e=r.targetTag)!=null&&e.trim()&&i.append("targetTag",r.targetTag.trim()),i.append("protocol",r.protocol||"https"),(c=r.username)!=null&&c.trim()&&i.append("username",r.username.trim()),(p=r.password)!=null&&p.trim()&&i.append("password",r.password.trim()),r.insecure&&i.append("insecure","true");const w=k.getAuthHeader(),T={"Content-Type":"application/x-www-form-urlencoded"};w&&(T.Authorization=w);const g=await fetch("/funeral_addition/mirror/pull",{method:"POST",headers:T,body:i,credentials:"include"});if(g.status===401)throw k.logout(),new Error("Authentication required. Please log in.");if(!g.ok){const _=((m=(f=(await g.json()).errors)==null?void 0:f[0])==null?void 0:m.message)||`Mirror failed: ${g.statusText}`;throw new Error(_)}const E=await g.json();a.value={success:!0,...E},b.success(`Successfully mirrored ${E.sourceImage}!`)}catch(s){console.error("Mirror error:",s),a.value={success:!1,error:s.message||"Mirror failed"},b.error(s.message||"Mirror failed")}finally{y.value=!1}},q=()=>{r.sourceImage="",r.targetRepository="",r.targetTag="",r.protocol="https",r.username="",r.password="",r.insecure=!1,a.value=null},A=()=>{var u;(u=a.value)!=null&&u.targetRepository&&D.push(`/repository/${a.value.targetRepository}`)},C=K(()=>{var p,f;if(!((p=a.value)!=null&&p.targetRepository)||!((f=a.value)!=null&&f.targetTag))return"";const{hostname:u,port:e}=window.location;return`docker pull ${e&&e!=="80"?`${u}:${e}`:u}/${a.value.targetRepository}:${a.value.targetTag}`}),B=async()=>{if(C.value)try{await navigator.clipboard.writeText(C.value),b.success("Pull command copied to clipboard")}catch{b.error("Failed to copy to clipboard")}};return(u,e)=>{const c=ue,p=ee,f=Z,m=Y,s=X,i=oe,w=le,T=re,g=ae,E=se,P=G,_=ne,V=de,R=ce,O=me,z=pe,S=fe,M=ye,F=be,N=ve,j=_e;return I(),h("div",Ee,[e[24]||(e[24]=o("div",{class:"page-header"},[o("h1",null,"ðŸ—ï¸ Mirror Image"),o("p",{class:"subtitle"},"Pull images from external registries directly to this registry")],-1)),t(V,{class:"mirror-card"},{header:l(()=>[o("div",Re,[e[8]||(e[8]=o("span",null,"ðŸ“¦ Pull from External Registry",-1)),t(c,{type:"success"},{default:l(()=>[...e[7]||(e[7]=[d("New Feature",-1)])]),_:1})])]),default:l(()=>[t(P,{ref:"mirrorForm",model:r,rules:H,"label-width":"140px",class:"mirror-form"},{default:l(()=>[t(s,{label:"Source Image",prop:"sourceImage"},{default:l(()=>[t(m,{modelValue:r.sourceImage,"onUpdate:modelValue":e[0]||(e[0]=n=>r.sourceImage=n),placeholder:"docker.1ms.run/library/nginx:latest",clearable:""},{append:l(()=>[t(f,{content:"Examples: nginx:latest, docker.1ms.run/library/mysql:8.0"},{default:l(()=>[t(p,null,{default:l(()=>[t(x(te))]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[9]||(e[9]=o("div",{class:"form-tip"},"Full image reference including registry, repository, and tag",-1))]),_:1}),t(s,{label:"Target Repository",prop:"targetRepository"},{default:l(()=>[t(m,{modelValue:r.targetRepository,"onUpdate:modelValue":e[1]||(e[1]=n=>r.targetRepository=n),placeholder:"nginx",clearable:""},null,8,["modelValue"]),e[10]||(e[10]=o("div",{class:"form-tip"},"Repository name in this registry (defaults to source repo name)",-1))]),_:1}),t(s,{label:"Target Tag",prop:"targetTag"},{default:l(()=>[t(m,{modelValue:r.targetTag,"onUpdate:modelValue":e[2]||(e[2]=n=>r.targetTag=n),placeholder:"latest",clearable:""},null,8,["modelValue"]),e[11]||(e[11]=o("div",{class:"form-tip"},"Tag for the mirrored image (defaults to source tag)",-1))]),_:1}),t(s,{label:"Protocol"},{default:l(()=>[t(w,{modelValue:r.protocol,"onUpdate:modelValue":e[3]||(e[3]=n=>r.protocol=n),style:{width:"100%"}},{default:l(()=>[t(i,{label:"HTTPS (Secure)",value:"https"}),t(i,{label:"HTTP (Insecure)",value:"http"})]),_:1},8,["modelValue"]),e[12]||(e[12]=o("div",{class:"form-tip"},"Choose the protocol for connecting to the external registry",-1))]),_:1}),t(T,{"content-position":"left"},{default:l(()=>[...e[13]||(e[13]=[d("Authentication (Optional)",-1)])]),_:1}),t(g,{title:"Leave empty for public images. For private images, provide registry credentials.",type:"info",closable:!1,"show-icon":"",class:"auth-alert"}),t(s,{label:"Username"},{default:l(()=>[t(m,{modelValue:r.username,"onUpdate:modelValue":e[4]||(e[4]=n=>r.username=n),placeholder:"registry username",clearable:""},null,8,["modelValue"])]),_:1}),t(s,{label:"Password"},{default:l(()=>[t(m,{modelValue:r.password,"onUpdate:modelValue":e[5]||(e[5]=n=>r.password=n),type:"password",placeholder:"registry password","show-password":"",clearable:""},null,8,["modelValue"])]),_:1}),t(s,{label:"Insecure"},{default:l(()=>[t(E,{modelValue:r.insecure,"onUpdate:modelValue":e[6]||(e[6]=n=>r.insecure=n),"active-text":"Allow insecure HTTPS"},null,8,["modelValue"]),e[14]||(e[14]=o("div",{class:"form-tip"},"Only enable for self-signed certificates",-1))]),_:1})]),_:1},8,["model"]),o("div",Ie,[t(_,{type:"primary",size:"large",loading:y.value,disabled:!r.sourceImage||y.value,onClick:$},{default:l(()=>[t(p,null,{default:l(()=>[t(x(ie))]),_:1}),e[15]||(e[15]=d(" Start Mirroring ",-1))]),_:1},8,["loading","disabled"]),t(_,{onClick:q,disabled:y.value},{default:l(()=>[...e[16]||(e[16]=[d(" Reset ",-1)])]),_:1},8,["disabled"])])]),_:1}),a.value?(I(),Q(V,{key:0,class:"result-card"},{header:l(()=>[...e[17]||(e[17]=[o("div",{class:"card-header"},[o("span",null,"ðŸ“Š Mirror Result")],-1)])]),default:l(()=>[a.value.success?(I(),h("div",Ve,[t(S,{icon:"success",title:"Mirror Successful"},{subTitle:l(()=>[o("div",he,[t(z,{column:1,border:""},{default:l(()=>[t(R,{label:"Source Image"},{default:l(()=>[t(c,{type:"info"},{default:l(()=>[d(v(a.value.sourceImage),1)]),_:1})]),_:1}),t(R,{label:"Target"},{default:l(()=>[t(c,{type:"success"},{default:l(()=>[d(v(a.value.targetRepository)+":"+v(a.value.targetTag),1)]),_:1})]),_:1}),t(R,{label:"Manifest Digest"},{default:l(()=>[t(O,{tag:"code",size:"small"},{default:l(()=>[d(v(a.value.manifestDigest),1)]),_:1})]),_:1}),t(R,{label:"Blobs Pulled"},{default:l(()=>[t(c,{type:"info"},{default:l(()=>[d(v(a.value.blobsCount),1)]),_:1})]),_:1})]),_:1}),o("div",xe,[t(_,{type:"primary",onClick:A},{default:l(()=>[...e[18]||(e[18]=[d(" View Repository ",-1)])]),_:1}),t(_,{onClick:B},{default:l(()=>[t(p,null,{default:l(()=>[t(x(ge))]),_:1}),e[19]||(e[19]=d(" Copy Pull Command ",-1))]),_:1})])])]),_:1})])):(I(),h("div",ke,[t(S,{icon:"error",title:"Mirror Failed"},{subTitle:l(()=>[t(g,{title:a.value.error,type:"error",closable:!1,"show-icon":""},null,8,["title"])]),_:1})]))]),_:1})):W("",!0),t(V,{class:"help-card"},{header:l(()=>[...e[20]||(e[20]=[o("div",{class:"card-header"},[o("span",null,"ðŸ’¡ Help & Examples")],-1)])]),default:l(()=>[t(j,null,{default:l(()=>[t(M,{title:"ðŸ“– How it works",name:"1"},{default:l(()=>[...e[21]||(e[21]=[o("div",{class:"help-content"},[o("p",null,"1. Enter the source image reference from any OCI-compliant registry"),o("p",null,"2. Optional: Customize the target repository name and tag"),o("p",null,"3. For private images, provide registry credentials"),o("p",null,"4. The service will pull the image and all its layers automatically")],-1)])]),_:1}),t(M,{title:"ðŸ“ Example References",name:"2"},{default:l(()=>[o("div",Ce,[t(N,{gutter:20},{default:l(()=>[t(F,{span:12},{default:l(()=>[...e[22]||(e[22]=[o("h4",null,"Docker Hub (Public)",-1),o("ul",null,[o("li",null,[o("code",null,"nginx:latest")]),o("li",null,[o("code",null,"mysql:8.0")]),o("li",null,[o("code",null,"ubuntu:20.04")])],-1)])]),_:1}),t(F,{span:12},{default:l(()=>[...e[23]||(e[23]=[o("h4",null,"Full References",-1),o("ul",null,[o("li",null,[o("code",null,"docker.io/library/alpine:3.18")]),o("li",null,[o("code",null,"gcr.io/google-containers/pause:3.2")]),o("li",null,[o("code",null,"quay.io/prometheus/prometheus:latest")])],-1)])]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1})])}}},Ae=Te(Pe,[["__scopeId","data-v-fb0bc337"]]);export{Ae as default};
